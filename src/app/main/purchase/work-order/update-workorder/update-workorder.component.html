<div class="modal-page page-layout inner-scroll">
    <div class="modal-wrapper grid-container">
        <!-- Modal header -->
        <div class="modal-header accent">
            <div class="modal-header-content">
                <div class="modal-header-title">
                    <span [@animate]="{ value: '*', params: { delay: '100ms', x: '-25px' } }">Work Order</span>
                </div>
                <div class="modal-header-right">
                    <div class="comman-date-container">
                        <app-common-date [screenFrom]="'OP-billing'"
                            (dateTimeEventEmitter)="getDateTime($event)"></app-common-date>
                        <div class="close-icon">
                            <button mat-icon-button tabIndex="-1" [mat-dialog-close]="true" aria-label="Close dialog"
                                matTooltip="Close">
                                <mat-icon>close</mat-icon>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal body -->
        <div class="modal-body">
            <div class="modal-body-container">
                <div fxLayout="column" class="h-100-p">
                    <mat-accordion>
                        <mat-expansion-panel expanded>
                            <mat-expansion-panel-header>
                                <mat-panel-title>
                                    <div class="panel-title" fxLayout="row" fxLayoutAlign="space-between center">
                                        <span>Purchase Order</span>
                                    </div>
                                </mat-panel-title>
                            </mat-expansion-panel-header>
                            <!-- <div fxLayout="column" fxLayout="row" fxLayoutAlign="start none"> -->
                                <div fxLayout="row" class="gap-2">
                                    <form [formGroup]="WorkOrderStoreForm" class="p-0">

                                        <airmid-dropdown label="Store Name" formControlName="StoreId" fxFlex
                                            [formGroup]="WorkOrderStoreForm" [mode]="autocompletestore"
                                            (selectionChange)="selectChangeStore($event)">
                                        </airmid-dropdown>
                                    </form>
                                    <form [formGroup]="WorkorderItemForm">
                                        <airmid-dropdown label="Supplier Name | Code" formControlName="SupplierName"
                                            fxFlex="35%" [formGroup]="WorkorderItemForm" [mode]="autocompleteSupplier"
                                            (selectionChange)="getSelectedSupplierObj($event)"></airmid-dropdown>

                                        <!-- [validations]="getValidationMessages().GSTType" -->
                                        <airmid-dropdown fxFlex="25%" label="Select GST Type" formControlName="GSTType"
                                            ValueField="value" [formGroup]="WorkorderItemForm"
                                            (selectionChange)="onGSTTypeChange($event)"
                                            [mode]="autocompleteModeGSTType"></airmid-dropdown>


                                        <app-common-date [screenFrom]="screenFromString"
                                            (dateTimeEventEmitter)="getDateTime($event)">
                                        </app-common-date>
                                    </form>
                                </div>

                                <div fxLayout="row" class="gap-2">
                                    <form [formGroup]="WorkorderItemForm">
                                        <input name="WorkId" formControlName="WorkId" [(ngModel)]="vWorkId"
                                            type="hidden">

                                        <airmid-autocomplete label="Item Name (enter 2 char)"
                                            [formGroup]="WorkorderItemForm" formControlName="ItemName"
                                            placeholderText="Item Name (enter 2 char)" fxFlex="15%"
                                            ApiUrl="ItemMaster/GetItemListForGRNOrPO?StoreId=2&ItemName="
                                            (selectionChange)="getSelectedItem($event)" TextField="formattedText"
                                            ValueField="itemId"
                                            (onClearSelection)="ItemFromReset()"></airmid-autocomplete>

                                        <airmid-textbox fxFlex="7%" label=" Qty" formControlName="Qty"
                                            (valueChange)="calculateTotalAmount()" [(ngModel)]="vQty"
                                            [formGroup]="WorkorderItemForm" type="number"
                                            (keypress)="keyPressAlphanumeric($event)"
                                            placeholder="Qty"></airmid-textbox>


                                        <airmid-textbox fxFlex="7%" label=" Rate" formControlName="UnitRate"
                                            (valueChange)="calculateTotalAmount()" [(ngModel)]="vRate"
                                            [formGroup]="WorkorderItemForm" type="number"
                                            (keypress)="keyPressAlphanumeric($event)"
                                            placeholder="UnitRate"></airmid-textbox>

                                        <airmid-textbox fxFlex="7%" label=" TotalAmount" formControlName="TotalAmount"
                                            [(ngModel)]="vTotalAmount" [formGroup]="WorkorderItemForm" type="number"
                                            placeholder="UnitRate"></airmid-textbox>


                                        <airmid-textbox fxFlex="7%" label=" Disc" formControlName="Disc"
                                            (valueChange)="calculateDiscperAmount()" [(ngModel)]="vDis"
                                            [formGroup]="WorkorderItemForm" type="number"
                                            (keypress)="keyPressAlphanumeric($event)"
                                            placeholder="Disc"></airmid-textbox>


                                        <airmid-textbox fxFlex="7%" label=" Disc Amount" formControlName="DiscAmt"
                                            [(ngModel)]="vDiscAmt" [formGroup]="WorkorderItemForm" type="number"
                                            (keypress)="keyPressAlphanumeric($event)"
                                            placeholder=" Disc Amount"></airmid-textbox>

                                        <airmid-textbox fxFlex="7%" label="GST%" formControlName="GST"
                                            [(ngModel)]="vGST" [formGroup]="WorkorderItemForm" type="number"
                                            (keypress)="keyPressAlphanumeric($event)"
                                            placeholder="GST"></airmid-textbox>

                                        <airmid-textbox fxFlex="7%" label="GST Amt" formControlName="GSTAmount"
                                            [(ngModel)]="vGST" [formGroup]="WorkorderItemForm" type="number"
                                            (keypress)="keyPressAlphanumeric($event)"
                                            placeholder="GST Amt"></airmid-textbox>

                                        <airmid-textbox fxFlex="10%" label="Net Amount" formControlName="NetAmount"
                                            [(ngModel)]="vNetAmount" [formGroup]="WorkorderItemForm" type="number"
                                            placeholder="Net Amount"></airmid-textbox>


                                        <div matTooltip="Select All Value to enable this button!!">
                                            <button class="btn btn-primary btn-with-icon py-8" (click)="onAdd()"
                                                [disabled]="WorkorderItemForm.invalid" #addbutton>
                                                <mat-icon>add</mat-icon>
                                            </button>
                                        </div>
                                    </form>
                                </div>

                            <!-- </div> -->
                        </mat-expansion-panel>
                    </mat-accordion>
                    <div class="airmid-table-container py-12" fxFlex>
                        <mat-table #table class="airmid-table table3 max-h-700" matSort [dataSource]="dsItemNameList"
                            [@animateStagger]="{ value: '50' }">

                            <ng-container matColumnDef="action" stickyEnd>
                                <mat-header-cell *matHeaderCellDef fxShow.gt-sm style="color: white;">Action
                                </mat-header-cell>
                                <mat-cell *matCellDef="let row">
                                    <button mat-icon-button matTooltip="Delete" (click)="deleteTableRow(row)"
                                        color="warn">
                                        <mat-icon>delete_outline</mat-icon>
                                    </button>
                                </mat-cell>
                            </ng-container>

                            <ng-container matColumnDef="ItemName">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxHide fxShow.gt-sm class="w-300">
                                    Item Name </mat-header-cell>
                                <mat-cell *matCellDef="let element" fxHide fxShow.gt-sm class="w-300">
                                    {{element.ItemName}} </mat-cell>
                            </ng-container>


                            <!-- <ng-container matColumnDef="Qty">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm
                                    class="w-80 border-right">Qty
                                </mat-header-cell>
                                <mat-cell class="w-80 border-right" *matCellDef="let contact" fxShow.gt-sm>
                                    <mat-form-field appearance="legacy">

                                        <input matInput [(ngModel)]="contact.Qty" type="text" OnlyNumber
                                            (keyup)="getCellCalculation(contact,contact.Qty)"
                                            (keypress)="keyPressAlphanumeric($event)">
                                    </mat-form-field>
                                </mat-cell>
                            </ng-container> -->

                            <ng-container matColumnDef="Qty">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm
                                    class="w-100">Qty</mat-header-cell>
                                <mat-cell *matCellDef="let contact" fxShow.gt-sm class="w-100">
                                    <mat-form-field appearance="fill">
                                        <input matInput [(ngModel)]="contact.Qty" type="number" OnlyNumber
                                            [id]="'Qty_' + index" (input)="getCellCalculation(contact)"
                                            [disabled]="contact.IsVerifiedUserId > 0" [min]="0" />
                                    </mat-form-field>
                                </mat-cell>
                            </ng-container>


                            <ng-container matColumnDef="Rate">
                                <mat-header-cell *matHeaderCellDef mat-sort-header class="w-100"
                                    fxShow.gt-sm>Rate</mat-header-cell>
                                <mat-cell *matCellDef="let contact; let index = index" fxShow.gt-sm class="w-100">
                                    <mat-form-field appearance="fill">
                                        <input matInput type="number" [(ngModel)]="contact.Rate" step="0.1"
                                            [id]="'Rate' + index" autocomplete="off" OnlyNumber
                                            (input)="getCellCalculation(contact)"
                                            (keydown.arrowdown)="setFocus('Rate' + (index + 1))"
                                            (keydown.arrowup)="setFocus('Rate' + (index - 1))"
                                            (keypress)="keyPressCharater($event)" [min]="0" />
                                    </mat-form-field>
                                </mat-cell>
                            </ng-container>


                          
                            <ng-container matColumnDef="TotalAmount">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxHide fxShow.gt-sm class="w-200">
                                    TotalAmount </mat-header-cell>
                                <mat-cell *matCellDef="let element" fxHide fxShow.gt-sm class="w-200">
                                    {{element.TotalAmount | number:'1.2-2'}} </mat-cell>
                            </ng-container>

                       
                            <!-- <ng-container matColumnDef="Disc">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm
                                    class="w-80 border-right">Disc%
                                </mat-header-cell>
                                <mat-cell class="w-80 border-right" *matCellDef="let contact" fxShow.gt-sm>
                                    <mat-form-field appearance="legacy">

                                        <input matInput [(ngModel)]="contact.DiscPer"
                                            (keyup)="getCellCalculation(contact,contact.DiscPer)"
                                            (keypress)="keyPressCharater($event)" step="0.1" type="text" OnlyNumber
                                            autocomplete="off">
                                    </mat-form-field>
                                </mat-cell>
                            </ng-container> -->

                            <ng-container matColumnDef="DiscPer">
                                <mat-header-cell *matHeaderCellDef mat-sort-header class="w-100"
                                    fxShow.gt-sm>Disc%</mat-header-cell>
                                <mat-cell *matCellDef="let contact; let index = index" fxShow.gt-sm class="w-100">
                                    <mat-form-field appearance="fill">
                                        <input matInput [(ngModel)]="contact.DiscPer" [id]="'DiscPer' + index"
                                            [disabled]="contact.IsVerifiedUserId > 0"
                                            (input)="getCellCalculation(contact)"
                                            (keydown.arrowdown)="setFocus('DiscPer' + (index + 1))"
                                            (keydown.arrowup)="setFocus('DiscPer' + (index - 1))" step="0.1"
                                            type="number" [min]="0" [max]="100" OnlyNumber autocomplete="off"
                                            (keypress)="keyPressCharater($event)" />
                                    </mat-form-field>
                                </mat-cell>Cell
                            </ng-container>

                            <ng-container matColumnDef="DiscAmt">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxHide fxShow.gt-sm class="w-100">
                                    DiscAmount </mat-header-cell>
                                <mat-cell *matCellDef="let element" fxHide fxShow.gt-sm class="w-100">
                                    {{element.DiscAmount | number:'1.2-2'}} </mat-cell>
                            </ng-container>

                            <!-- <ng-container matColumnDef="Vat">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxHide fxShow.gt-sm>
                                    GST% </mat-header-cell>
                                <mat-cell *matCellDef="let element" fxHide fxShow.gt-sm>
                                    {{element.VATPer}}% </mat-cell>
                            </ng-container> -->

                          
                            <ng-container matColumnDef="Vat">
                                <mat-header-cell *matHeaderCellDef mat-sort-header class="w-100"
                                    fxShow.gt-sm>GST%</mat-header-cell>
                                <mat-cell *matCellDef="let contact; let index = index" fxShow.gt-sm class="w-100">
                                    <mat-form-field appearance="fill">
                                        <input matInput [(ngModel)]="contact.VATPer" [id]="'VATPer' + index"
                                            (input)="getCellCalculation(contact)"
                                            (keydown.arrowdown)="setFocus('VATPer' + (index + 1))"
                                            (keydown.arrowup)="setFocus('VATPer' + (index - 1))" step="0.1"
                                            type="number" [min]="0" [max]="100" OnlyNumber autocomplete="off"
                                            (keypress)="keyPressCharater($event)" />
                                    </mat-form-field>
                                </mat-cell>Cell
                            </ng-container>

                            <ng-container matColumnDef="VatAmt">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxHide fxShow.gt-sm class="w-100">
                                    GSTAmount </mat-header-cell>
                                <mat-cell *matCellDef="let element" fxHide fxShow.gt-sm class="w-100">
                                    {{element.VATAmount | number:'1.2-2'}} </mat-cell>
                            </ng-container>

                            <ng-container matColumnDef="NetAmt">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxHide fxShow.gt-sm class="w-100">
                                    NetAmount </mat-header-cell>
                                <mat-cell *matCellDef="let element" fxHide fxShow.gt-sm class="w-100">
                                    {{element.NetAmount | number:'1.2-2'}} </mat-cell>
                            </ng-container>

                            <!-- <ng-container matColumnDef="Specification">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxHide fxShow.gt-sm>
                                    Remark </mat-header-cell>
                                <mat-cell *matCellDef="let element" 5fxHide fxShow.gt-sm>
                                    {{element.Remark}} </mat-cell>
                            </ng-container> -->
                            <ng-container matColumnDef="loading">
                                <mat-header-cell *matFooterCellDef colspan="6" style="display: none"></mat-header-cell>
                            </ng-container>

                            <ng-container matColumnDef="noData">
                                <mat-footer-cell *matFooterCellDef colspan="6">no data found...</mat-footer-cell>
                            </ng-container>

                            <mat-header-row class="accent min-width-1000"
                                *matHeaderRowDef="displayedColumnsnew; sticky: true"></mat-header-row>
                            <mat-row *matRowDef="let contact; columns: displayedColumnsnew; let i = index" tabindex="999"
                                class="contact min-width-1000" [@animate]="{ value: '*', params: { y: '100%' } }"
                                appHighlight></mat-row>
                            <mat-footer-row *matFooterRowDef="['loading']"
                                [ngClass]="{ hide: !(sIsLoading == 'loading-data') }"></mat-footer-row>
                            <mat-footer-row *matFooterRowDef="['noData']"
                                [ngClass]="{ hide: !(dsItemNameList != null && dsItemNameList.data.length == 0) }"></mat-footer-row>
                        </mat-table>
                    </div>

                    <mat-accordion>
                        <mat-expansion-panel expanded>
                            <mat-expansion-panel-header>
                                <mat-panel-title>Total Amount Summary </mat-panel-title>
                                <div>
                                    <span class="net-amt-mat-label"
                                        style="font-weight:bold;margin-left:20px;padding-top: 10px;width:100px;">Total
                                        Amount: </span>&nbsp;
                                    <span class="net-amt-value"
                                        style="margin-left:10px;font-weight:bolder;color: blue;padding-top: 10px;">{{getTotalAmt(dsItemNameList.data)
                                        | currency:'INR' }}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

                                    <span class="net-amt-mat-label"
                                        style="font-weight:bold;margin-left:20px;padding-top: 10px;">Total
                                        Disc Amt:
                                    </span>&nbsp;
                                    <span class="net-amt-value"
                                        style="margin-left:10px;font-weight:bolder;color: blue;padding-top: 10px;">{{getTotalDisc(dsItemNameList.data)
                                        | currency:'INR' }}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

                                    <span class="net-amt-mat-label"
                                        style="font-weight:bold;margin-left:20px;padding-top: 10px;">Total
                                        GST Amt:
                                    </span>&nbsp;
                                    <span class="net-amt-value"
                                        style="margin-left:10px;font-weight:bolder;color: blue;padding-top: 10px;">{{getTotalVAT(dsItemNameList.data)
                                        |
                                        currency:'INR' }}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

                                    <span class="net-amt-mat-label"
                                        style="font-weight:bold;margin-left:20px;padding-top: 10px;">Total
                                        Net Amt:
                                    </span>&nbsp;
                                    <span class="net-amt-value"
                                        style="margin-left:10px;font-weight:bolder;color: blue;padding-top: 10px;">{{getTotalNet(dsItemNameList.data)
                                        |
                                        currency:'INR' }}</span>
                                </div>
                            </mat-expansion-panel-header>

                            <div fxLayout="column" fxLayout.gt-xs="row" class="gap-12">
                                <form [formGroup]="WorkorderFinalForm" style="padding: 10px 6px 5px 5px;">
                                    <div fxLayoutGap="6px">


                                        <airmid-textbox fxFlex="40%" label="Remark" formControlName="Remark"
                                            [formGroup]="WorkorderFinalForm" type="text"
                                            placeholder="Remark"></airmid-textbox>

                                        <airmid-textbox fxFlex="15%" label="Total DiscAmount"  [(ngModel)]="FinalDiscAmount"
                                            formControlName="FinalDiscAmount" [formGroup]="WorkorderFinalForm"
                                            type="number" placeholder="Total DiscAmount"></airmid-textbox>

                                        <airmid-textbox fxFlex="15%" label="Total Amount"
                                            formControlName="FinalTotalAmount" [formGroup]="WorkorderFinalForm"
                                            type="number" [(ngModel)]="FinalTotalAmount"
                                            placeholder="Total Amount"></airmid-textbox>

                                        <airmid-textbox fxFlex="15%" label="Total GSTAmount" formControlName="VatAmount"
                                            [formGroup]="WorkorderFinalForm" type="number" [(ngModel)]="FinalVatAmount"
                                            placeholder="Total GSTAmount"></airmid-textbox>

                                        <airmid-textbox fxFlex="15%" label="NET Amount" formControlName="FinalNetAmount"
                                            [formGroup]="WorkorderFinalForm" type="number" [(ngModel)]="FinalNetAmount"
                                            placeholder="FinalNetAmount"></airmid-textbox>


                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <div class="footer-navigation-container">
                                    <div class="modal-footer-buttons">
                                        <button class="btn btn-danger-outline" (click)="OnReset()">Close</button>
                                        <button type="button" class="btn btn-primary" [disabled]="false"
                                            (click)="OnSave()">Save</button>
                                    </div>
                                </div>
                            </div>
                        </mat-expansion-panel>
                    </mat-accordion>
                </div>
            </div>

        </div>
        <!-- Modal footer -->

    </div>
</div>