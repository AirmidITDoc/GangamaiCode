<div class="modal-wrapper grid-container">
  <div class="modal-header accent">
    <div class="modal-header-content">
      <div class="modal-header-title">
        <span [@animate]="{ value: '*', params: { delay: '100ms', x: '-25px' } }">
          {{ testForm.controls.TestId.value ? 'Modify Test Master' : 'New Test Master' }}
        </span>
      </div>
      <div class="modal-header-right">
        <div class="close-icon">
          <button mat-icon-button tabIndex="-1" (click)="onClose(false)" matTooltip="Close">
            <mat-icon>close</mat-icon>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-body" fusePerfectScrollbar>
    <div class="modal-body-container">
      <form [formGroup]="testForm" fxFlexFill fxLayout="row" fxLayout.gt-xs="column">
        <!-- 4 testfields -->
        <div fxLayout="row" fxLayoutGap="5px">
          <div fxFlex="25%" fxFlex.xs="100%" fxFlex.sm="33%">
            <airmid-textbox
              label="Test name"
              formControlName="TestName"
              [value]="registerObj?.testName"
              [formGroup]="testForm"
              [validations]="_TestmasterService.getValidationMessages().TestName"
              [maxLength]="50"
            ></airmid-textbox>
          </div>

          <div fxFlex="25%" fxFlex.xs="100%" fxFlex.sm="33%">
            <airmid-textbox
              label="PrintTestName"
              formControlName="PrintTestName"
              [value]="registerObj?.printTestName"
              [formGroup]="testForm"
              [validations]="_TestmasterService.getValidationMessages().PrintTestName"
              [maxLength]="50"
            ></airmid-textbox>
          </div>

          <div fxFlex="25%" fxFlex.xs="100%" fxFlex.sm="33%">
            <airmid-dropdown
              label="CategoryName"
              formControlName="CategoryId"
              [value]="registerObj?.categoryId"
              [formGroup]="testForm"
              [validations]="_TestmasterService.getValidationMessages().CategoryId"
              [mode]="autocompleteModeCategoryId"
              (selectionChange)="selectChangeCategoryId($event)"
            ></airmid-dropdown>
          </div>

          <div fxFlex="25%" fxFlex.xs="100%" fxFlex.sm="33%">
            <airmid-dropdown
              label="ServiceName"
              formControlName="ServiceId"
              [value]="registerObj?.serviceID"
              [formGroup]="testForm"
              [mode]="autocompleteModeServiceID"
              (selectionChange)="selectChangeServiceID($event)"
              *ngIf="serviceflag"
            ></airmid-dropdown>
          </div>
        </div>

        <!-- radiobuttons -->
        <div fxLayout="row" fxLayoutGap="5px">
          <section class="example-section">
            <mat-radio-group name="Status" formControlName="Status" fxLayout="row">
              <mat-radio-button (click)="toggle(1)" value="1" [checked]="_TestmasterService.is_Test" class="mr-sm-12">Test</mat-radio-button>
              <mat-radio-button (click)="toggle(2)" value="2" [checked]="_TestmasterService.is_subtest" class="mr-sm-12">IsSubTest</mat-radio-button>
              <mat-radio-button (click)="toggle(3)" value="3" [checked]="_TestmasterService.is_templatetest" class="mr-sm-12">Template Formate</mat-radio-button>
            </mat-radio-group>
          </section>
        </div>

        <!-- search and check box -->
        <div fxLayout="row" class="pt-12">
          <div *ngIf="!_TestmasterService.is_templatetest">
            <mat-form-field style="width: 22rem">
              <input matInput placeholder="Search" autocomplete="off" name="ParameterNameSearch" (keyup)="onSearch()" formControlName="ParameterNameSearch" />
              <button matSuffix mat-icon-button aria-label="Clear" (click)="onSearchClear()" (keyup)="onSearch()">
                <mat-icon>close</mat-icon>
              </button>
            </mat-form-field>

            <mat-checkbox formControlName="IsSubTest" [(ngModel)]="isChecked" (change)="onSearch()" value="true" name="IsSubTest">IsSubTest</mat-checkbox>
          </div>

          <!-- [checked]='_TestmasterService.is_subtest' -->
        </div>

        <!-- parameter value column -->
        <ng-template [ngIf]="_TestmasterService.is_subtest || _TestmasterService.is_Test">
          <!-- *ngIf="!isChecked" -->
          <div fxLayout="row" fxFlex="100%" fxLayoutGap="8px grid" class="overflow-auto">
            <div fxLayout="column" fxFlex="30">
              <mat-card class="airmid-table-container h-100-p">
                <mat-table class="airmid-table one-column-table" matSort [dataSource]="paramterList" [@animateStagger]="{ value: '50' }">
                  <ng-container matColumnDef="parameterName">
                    <mat-header-cell *matHeaderCellDef mat-sort-header>Parameter Values</mat-header-cell>
                    <mat-cell *matCellDef="let element" fxShow.gt-sm (click)="onAdd(element)">
                      <mat-icon (click)="onAdd(element)" style="cursor: pointer; margin-right: 10px">add</mat-icon>

                      {{ element.parameterName }}
                    </mat-cell>
                  </ng-container>

                  <ng-container matColumnDef="loading">
                    <mat-footer-cell *matFooterCellDef colspan="6"></mat-footer-cell>
                  </ng-container>

                  <mat-header-row class="accent" *matHeaderRowDef="displayedColumns; sticky: true"></mat-header-row>
                  <mat-row *matRowDef="let element; columns: displayedColumns" class="element" [@animate]="{ value: '*', params: { y: '100%' } }"></mat-row>
                </mat-table>

                <mat-table #table class="airmid-table" matSort *ngIf="isTemplate" [dataSource]="TemplateList.data" [@animateStagger]="{ value: '50' }">
                  <ng-container matColumnDef="ParameterName">
                    <mat-header-cell *matHeaderCellDef mat-sort-header>Parameter Values</mat-header-cell>
                    <mat-cell *matCellDef="let element" fxShow.gt-sm (click)="onAdd(element)">
                      {{ element.parameterName }}
                    </mat-cell>
                  </ng-container>

                  <ng-container matColumnDef="Add">
                    <mat-header-cell *matHeaderCellDef>Add</mat-header-cell>
                    <mat-cell *matCellDef="let element" fxShow.gt-sm style="padding-left: 2rem">
                      <mat-icon (click)="onAdd(element)" style="cursor: pointer">add</mat-icon>
                    </mat-cell>
                  </ng-container>

                  <ng-container matColumnDef="loading">
                    <mat-footer-cell *matFooterCellDef colspan="6"></mat-footer-cell>
                  </ng-container>
                  <mat-header-row class="accent" *matHeaderRowDef="displayedColumns; sticky: true"></mat-header-row>
                  <mat-row *matRowDef="let row; columns: displayedColumns" class="element" [@animate]="{ value: '*', params: { y: '100%' } }"></mat-row>
                </mat-table>
              </mat-card>
            </div>

            <div fxLayout="column" fxFlex="70">
              <mat-card class="airmid-table-container h-100-p">
                <mat-table #table class="airmid-table" matSort [dataSource]="DSTestList" cdkDropList (cdkDropListDropped)="drop($event)">
                  <ng-container matColumnDef="Reorder">
                    <mat-header-cell *matHeaderCellDef>#</mat-header-cell>
                    <mat-cell *matCellDef="let element">
                      <mat-icon style="cursor: pointer">reorder</mat-icon>
                    </mat-cell>
                  </ng-container>
                  <ng-container matColumnDef="ParameterName">
                    <mat-header-cell *matHeaderCellDef mat-sort-header>Parameter</mat-header-cell>
                    <mat-cell *matCellDef="let element" fxShow.gt-sm>
                      {{ element.parameterName }}
                    </mat-cell>
                  </ng-container>
                  <ng-container matColumnDef="PrintParameterName">
                    <mat-header-cell *matHeaderCellDef mat-sort-header>PrintParameterName</mat-header-cell>
                    <mat-cell *matCellDef="let element" fxShow.gt-sm>
                      {{ element.printParameterName }}
                    </mat-cell>
                  </ng-container>
                  <ng-container matColumnDef="MethodName">
                    <mat-header-cell *matHeaderCellDef mat-sort-header>MethodName</mat-header-cell>
                    <mat-cell *matCellDef="let element" fxShow.gt-sm>
                      {{ element.methodName }}
                    </mat-cell>
                  </ng-container>
                  <ng-container matColumnDef="UnitName">
                    <mat-header-cell *matHeaderCellDef mat-sort-header>Unit</mat-header-cell>
                    <mat-cell *matCellDef="let element">
                      {{ element.unitName }}
                    </mat-cell>
                  </ng-container>

                  <ng-container matColumnDef="ParaMultipleRange">
                    <mat-header-cell *matHeaderCellDef mat-sort-header>Range</mat-header-cell>
                    <mat-cell *matCellDef="let element">
                      {{ element.ParaMultipleRange }}
                    </mat-cell>
                  </ng-container>
                  <ng-container matColumnDef="Formula">
                    <mat-header-cell *matHeaderCellDef mat-sort-header>Formula</mat-header-cell>
                    <mat-cell *matCellDef="let element">
                      {{ element.formula }}
                    </mat-cell>
                  </ng-container>
                  <ng-container matColumnDef="IsNumeric">
                    <mat-header-cell *matHeaderCellDef mat-sort-header>IsNumeric</mat-header-cell>
                    <mat-cell *matCellDef="let element">
                      {{ element.IsNumeric }}
                    </mat-cell>
                  </ng-container>

                  <ng-container matColumnDef="Action" stickyEnd>
                    <mat-header-cell *matHeaderCellDef>Action</mat-header-cell>
                    <mat-cell *matCellDef="let element">
                      <button mat-icon-button color="warn" (click)="onDeleteRow(element)">
                        <mat-icon>delete</mat-icon>
                      </button>
                    </mat-cell>
                  </ng-container>

                  <ng-container matColumnDef="loading">
                    <mat-footer-cell *matFooterCellDef colspan="6"></mat-footer-cell>
                  </ng-container>

                  <ng-container matColumnDef="noData">
                    <mat-footer-cell *matFooterCellDef colspan="6">Select Parameters...</mat-footer-cell>
                  </ng-container>

                  <mat-header-row class="accent" class="accent min-width-1500 airmid-row" *matHeaderRowDef="displayedColumns2; sticky: true"></mat-header-row>
                  <mat-row *matRowDef="let row; columns: displayedColumns2" class="element" class="element min-width-1500 airmid-row" [@animate]="{ value: '*', params: { y: '100%' } }" cdkDrag></mat-row>
                  <mat-footer-row *matFooterRowDef="['loading']" [ngClass]="{ hide: DSTestList != null }"></mat-footer-row>
                </mat-table>
              </mat-card>
            </div>
          </div>
        </ng-template>

        <ng-template [ngIf]="_TestmasterService.is_templatetest">
            <div fxLayout="column" fxLayout.gt-xs="row" fxLayoutGap="10px" fxFlex>
              <div fxFlex.gt-sm="100%" fxFlex>
                <div fxlayout="row">
                  <form [formGroup]="templatedetailsForm">
                    <input type="hidden" name="TemplateId" formControlName="TemplateId" />

                    <div class="dialog-content-wrapper">
                      <div fxFlexFill fxLayout="row" fxLayout.gt-xs="column">
                        <div fxLayout="row" fxLayoutGap="5px">
                          <div fxFlex="25%" fxFlex.xs="100%" fxFlex.sm="33%">
                            <airmid-dropdown
                              label="TemplateName"
                              formControlName="TemplateName"
                              [formGroup]="templatedetailsForm"
                              [validations]="_TestmasterService.getValidationMessages().TemplateName"
                              [mode]="autocompleteModeTemplate"
                              (selectionChange)="selectChangeTemplate($event)"
                            ></airmid-dropdown>
                          </div>
                          <div>
                              <button (click)="onAddTemplate()" class="btn btn-primary btn-with-icon py-8 ml-8">
                                <span class="btn-icon">
                                  <mat-icon>add</mat-icon>
                                </span>
                              </button>
                          </div>
                        </div>
                        <div fxFlexFill fxLayout="row">
                          <mat-table matSort [dataSource]="Templatetdatasource" [@animateStagger]="{ value: '50' }" class="h-420">
                            <ng-container matColumnDef="TemplateName">
                              <mat-header-cell *matHeaderCellDef mat-sort-header>TemplateName</mat-header-cell>
                              <mat-cell *matCellDef="let element" fxShow.gt-sm>
                                {{ element.templateName }}
                              </mat-cell>
                            </ng-container>

                            <ng-container matColumnDef="Action">
                              <mat-header-cell *matHeaderCellDef>Action</mat-header-cell>
                              <mat-cell *matCellDef="let element">
                                <button mat-icon-button color="warn" (click)="onDeleteTemplateRow(element)">
                                  <mat-icon>delete</mat-icon>
                                </button>
                              </mat-cell>
                            </ng-container>

                            <ng-container matColumnDef="loading">
                              <mat-footer-cell *matFooterCellDef colspan="6"></mat-footer-cell>
                            </ng-container>

                            <mat-header-row class="accent" *matHeaderRowDef="displayedColumns5; sticky: true"></mat-header-row>
                            <mat-row *matRowDef="let row; columns: displayedColumns5" class="element" [@animate]="{ value: '*', params: { y: '100%' } }"></mat-row>
                          </mat-table>
                        </div>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
        </ng-template>

        <hr />

        <div fxLayout="row wrap" fxLayoutGap="12px 0px grid" *ngIf="!_TestmasterService.is_templatetest">
          <div fxFlex="50%" fxFlex.xs="100%" fxFlex.sm="33%">
            <airmid-textbox
              label="TechniqueName"
              formControlName="TechniqueName"
              [value]="registerObj?.techniqueName"
              [formGroup]="testForm"
              [maxLength]="50"
            ></airmid-textbox>
          </div>
          <div fxFlex="50%" fxFlex.xs="100%" fxFlex.sm="33%">
            <airmid-textbox
              label="MachineName"
              formControlName="MachineName"
              [value]="registerObj?.machineName"
              [formGroup]="testForm"
              [maxLength]="50"
            ></airmid-textbox>
          </div>
          <div fxFlex="50%" fxFlex.xs="100%" fxFlex.sm="33%">
            <airmid-textbox
              label="Foot Note"
              formControlName="FootNote"
              [value]="registerObj?.footNote"
              [formGroup]="testForm"
              [maxLength]="50"
            ></airmid-textbox>
          </div>

          <div fxFlex="50%" fxFlex.xs="100%" fxFlex.sm="33%">
            <airmid-textbox
              label="Suggestion Note"
              formControlName="SuggestionNote"
              [value]="registerObj?.suggestionNote"
              [formGroup]="testForm"
              [maxLength]="50"
            ></airmid-textbox>
          </div>
        </div>
      </form>
    </div>
  </div>

  <div class="modal-footer">
    <div class="footer-navigation-container">
      <div class="modal-footer-container">
        <form [formGroup]="testForm">
          <app-airmid-slider label="IsActive/Deactive" formControlName="isActive" [formGroup]="testForm" [(ngModel)]="isActive"></app-airmid-slider>
        </form>
        <div class="modal-footer-buttons">
          <button class="btn btn-danger-outline" (click)="onClose(false)">Close</button>
          <button type="button" class="btn btn-primary" (click)="onSubmit()">Save</button>
        </div>
      </div>
    </div>
  </div>
</div>
