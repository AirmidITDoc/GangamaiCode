<div class="modal-wrapper grid-container">
  <div class="modal-header accent">
    <div class="modal-header-content">
      <div class="modal-header-title">
        <span [@animate]="{ value: '*', params: { delay: '100ms', x: '-25px' } }">Discharge Summary Template</span>
      </div>
      <div class="modal-header-right">
        <div class="comman-date-container">
          <div class="comman-date">
            <app-common-date [screenFrom]="screenFromString" (dateTimeEventEmitter)="getDateTime($event)"></app-common-date>
          </div>
          <div class="close-icon">
            <button mat-icon-button tabIndex="-1" (click)="onClose()" aria-label="Close dialog">
              <mat-icon>close</mat-icon>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-body">
    <div class="content-card h-100-p" fxLayout="column">
      <mat-card>
        <mat-card-content>
          <div class="patient-info-container">
            <div class="patient-info-box">
              <div class="patient-info-title border-bottom pb-2">
                <span class="h2 font-weight-600">Patient Information</span>
              </div>
              <div class="patient-sub">
                <div class="patient-sub">
                  <div class="patient-info-row patient-info-1-111 pt-8" fxLayout="row" fxLayoutAlign="space-between">
                    <div fxLayout="column" fxLayoutGap="6px">
                      <div class="patient-col">
                        <span class="patient-col-key">UHID No</span>
                        <span>:</span>
                        <span class="patient-col-value">{{ data.regNo }}</span>
                      </div>
                      <div class="patient-col">
                        <span class="patient-col-key">Patient Name</span>
                        <span>:</span>
                        <span class="patient-col-value">{{ data.patientName }}</span>
                      </div>
                      <div class="patient-col">
                        <span class="patient-col-key">Doctor Name</span>
                        <span>:</span>
                        <span class="patient-col-value">{{ data.doctorname }}</span>
                      </div>
                      <div class="patient-col">
                        <span class="patient-col-key">Department</span>
                        <span>:</span>
                        <span class="patient-col-value">{{ data.departmentName }}</span>
                      </div>
                    </div>
                    <div fxLayout="column" fxLayoutGap="6px">
                      <div class="patient-col">
                        <span class="patient-col-key">DOA | Time</span>
                        <span>:</span>
                        <span class="patient-col-value">{{ data.doa }}</span>
                      </div>
                      <div class="patient-col">
                        <span class="patient-col-key">IPD No</span>
                        <span>:</span>
                        <span class="patient-col-value">{{ data.ipdno }}</span>
                      </div>
                      <div class="patient-col">
                        <span class="patient-col-key">Age | Sex</span>
                        <span>:</span>
                        <span class="patient-col-value">{{ data.ageYear }}Y|{{ data.ageMonth }}M|{{ data.ageDay }} D | {{ data.genderName }}</span>
                      </div>
                      <div class="patient-col">
                        <span class="patient-col-key">Ref-Doctor Name</span>
                        <span>:</span>
                        <span class="patient-col-value">{{ data.refDocName }}</span>
                      </div>
                    </div>
                    <div fxLayout="column" fxLayoutGap="1px">
                      <div class="patient-col">
                        <span class="patient-col-key">Ward | Bed Name</span>
                        <span>:</span>
                        <span class="patient-col-value">{{ data.RoomName }} | {{ data.bedName }}</span>
                      </div>
                      <div class="patient-col">
                        <span class="patient-col-key">Patient Type</span>
                        <span>:</span>
                        <span class="patient-col-value">{{ data.patientType }}</span>
                      </div>
                      <div class="patient-col">
                        <span class="patient-col-key">Tarrif Name</span>
                        <span>:</span>
                        <span class="patient-col-value">{{ data.tariffName }}</span>
                      </div>
                      <div class="patient-col">
                        <span class="patient-col-key">Company Name</span>
                        <span>:</span>
                        <span class="patient-col-value" style="color: orange">{{ data.companyName }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-tab-group class="dynamic-table-wrapper">
        <mat-tab>
          <ng-template mat-tab-label>Template Detail</ng-template>
          <div class="content-card mt-8 input-error-hidden">
            <form [formGroup]="DischargesumForm" fxLayout="column" fxLayoutGap="8px">
              <div fxLayout="row" fxLayoutGap="8px" fxLayoutAlign="start center">
                <airmid-dropdown
                  label="Template"
                  formControlName="TemplateId"
                  [formGroup]="DischargesumForm"
                  fxFlex="40%"
                  [value]="TemplateId"
                  ValueField="templateId"
                  TextField="templateName"
                  (selectionChange)="onChangetemp($event)"
                  ApiUrl="ReportTemplate/get-Templates"
                ></airmid-dropdown>

                <div class="mt-2">
                  <button type="button" (click)="onAddTemplate($event)" class="btn btn-primary btn-with-icon py-8" [disabled]="!isItemIdSelected" fxFlex>
                    <span class="btn-icon">
                      <mat-icon>add</mat-icon>
                    </span>
                  </button>
                </div>
              </div>

              <!-- EDITOR -->
              <airmid-editor label="Template Details" formControlName="templateDesc" [(value)]="vTemplateDesc" [formGroup]="DischargesumForm"></airmid-editor>

              <div fxLayout="row wrap" fxLayoutGap="8px" class="mt-8">
                <div fxFlex="25%" fxFlex.xs="100%" fxFlex.sm="33%">
                  <airmid-dropdown
                    label="Doctor Name"
                    formControlName="dischargeDoctor1"
                    [formGroup]="DischargesumForm"
                    [validations]="getValidationMessages().dischargeDoctor1"
                    [mode]="autocompleteModeDoctor"
                  ></airmid-dropdown>
                </div>
                <div fxFlex="25%" fxFlex.xs="100%" fxFlex.sm="33%">
                  <airmid-dropdown
                    label="RMO.Doctor Name"
                    formControlName="dischargeDoctor2"
                    [formGroup]="DischargesumForm"
                    [validations]="getValidationMessages().dischargeDoctor2"
                    [mode]="autocompleteModeRefDoctor"
                  ></airmid-dropdown>
                </div>
              </div>
            </form>
          </div>
        </mat-tab>

        <mat-tab label="MEDICINE AT THE TIME OF DISCHARGE">
          <div class="form-container h-100-p" fxLayout="column">
            <div class="modal-card-container">
              <div class="form-title mb-2 pb-2 border-bottom">
                <span class="h3 font-weight-600">MEDICINE AT THE TIME OF DISCHARGE</span>
              </div>

              <div fxLayout="column" fxLayoutGap="10px">
                <div fxFlex.gt-sm="100%" fxFlex>
                  <form [formGroup]="MedicineItemForm">
                    <div fxFlexFill fxLayout="column" fxLayout.gt-xs="row" class="gap-8">
                      <airmid-autocomplete
                        label="Enter Item Name"
                        [formGroup]="MedicineItemForm"
                        formControlName="ItemId"
                        placeholderText="Enter Item Name"
                        fxFlex
                        ApiUrl="ItemMaster/GetItemListForPrescription?StoreId=2&ItemName="
                        (selectionChange)="getSelectedserviceObj($event)"
                        TextField="itemName"
                        ValueField="itemId"
                      ></airmid-autocomplete>

                      <airmid-dropdown
                        label="Dose Name"
                        formControlName="DoseId"
                        [formGroup]="MedicineItemForm"
                        [validations]="getValidationMessages().DoseId"
                        (selectionChange)="getdose($event)"
                        [mode]="autocompleteModeDose"
                      ></airmid-dropdown>

                      <airmid-textbox label="Day" formControlName="Day" [value]="vDay" [formGroup]="MedicineItemForm" [type]="'text'" (keypress)="keyPressCharater($event)"></airmid-textbox>

                      <div class="input-add-button">
                        <div matTooltip="Select Itemname to enable this button!!" [matTooltipPosition]="'above'" fxLayoutGap="10px" fxLayout="row">
                          <button #addbutton class="btn btn-primary btn-with-icon" (click)="onAdd()">
                            <span class="btn-icon">
                              <mat-icon>add</mat-icon>
                            </span>
                            <span>Add</span>
                          </button>
                        </div>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
            <div class="modal-card-container table-container overflow-auto" >
              <!-- Table 1 -->
              <div class="airmid-table-container">
                <div class="content-card">
                  <mat-table class="airmid-table" matSort [dataSource]="dsItemList" [@animateStagger]="{ value: '50' }">
                    <ng-container matColumnDef="itemName">
                      <mat-header-cell *matHeaderCellDef mat-sort-header fxHide fxShow.gt-sm>ItemName</mat-header-cell>
                      <mat-cell *matCellDef="let element" fxHide fxShow.gt-sm>
                        <span>{{ element.itemName }}</span>
                      </mat-cell>
                    </ng-container>

                    <ng-container matColumnDef="doseName">
                      <mat-header-cell *matHeaderCellDef mat-sort-header fxHide fxShow.gt-sm>Dose Name</mat-header-cell>
                      <mat-cell *matCellDef="let element" fxHide fxShow.gt-sm>
                        <span>{{ element.doseName }}</span>
                      </mat-cell>
                    </ng-container>

                    <ng-container matColumnDef="day">
                      <mat-header-cell *matHeaderCellDef mat-sort-header fxHide fxShow.gt-sm>Day</mat-header-cell>
                      <mat-cell *matCellDef="let element" fxHide fxShow.gt-sm>
                        <span>{{ element.days }}</span>
                      </mat-cell>
                    </ng-container>

                    <ng-container matColumnDef="Action" stickyEnd>
                      <mat-header-cell *matHeaderCellDef class="table-actions">Action</mat-header-cell>
                      <mat-cell *matCellDef="let contact">
                        <ng-container class="actions">
                          <mat-icon (click)="deleteTableRow($event, contact)" color="warn">delete</mat-icon>
                        </ng-container>
                      </mat-cell>
                    </ng-container>

                    <mat-header-row class="accent" *matHeaderRowDef="displayedColumns; sticky: true"></mat-header-row>
                    <mat-row *matRowDef="let row; columns: displayedColumns" class="element" [@animate]="{ value: '*', params: { y: '100%' } }"></mat-row>
                  </mat-table>
                </div>
              </div>
            </div>
          </div>
        </mat-tab>
      </mat-tab-group>
    </div>
  </div>
  <div class="modal-footer">
    <div class="modal-footer-container" fxLayoutAlign="end center" fxLayoutGap="16px">
      <form [formGroup]="DischargesumForm">
        <mat-radio-group [formGroup]="DischargesumForm" formControlName="isNormalOrDeath" [(ngModel)]="vIsNormalDeath">
          <mat-radio-button mat-fab value="1">Normal</mat-radio-button>
          <mat-radio-button mat-fab value="0">Death Summary</mat-radio-button>
        </mat-radio-group>
      </form>

      <div fxLayout="row" fxLayoutAlign="end start" fxLayoutGap="6px">
        <button class="btn btn-danger-outline" (click)="onClose()">Close</button>
        <button class="btn btn-primary" (click)="OnSave()">Save</button>
      </div>
    </div>
  </div>
</div>
