<div fxFlexFill fxLayout="row" fxLayout.gt-xs="column" fxLayoutGap="10px"
    style="background-color: #F5F5F5;height:auto;font-size:18px;">
    

    <div class="header accent p-10 p-sm-20" fxLayout="column" fxLayoutAlign="start" fxLayout.gt-xs="row"
        fxLayoutAlign.gt-xs="space-between center " style="height:40px;">

        <!-- APP TITLE -->
        <div fxLayout="row" fxLayoutAlign="space-between center" style="width: 100%;">
            
            <span [@animate]="{value:'*',params:{delay:'100ms',x:'-25px'}}"
                style="font-size:18px; font-weight: 500;width:99%;font-family: sans-serif;">
                IP BILLING : 
                <span> RegNo - {{selectedAdvanceObj.RegNo}} - {{selectedAdvanceObj.PatientName}} (IPD
                    No:{{selectedAdvanceObj.IPDNo}}) - AdmissionDate:{{selectedAdvanceObj.AdmDateTime}} -
                    Ward:{{selectedAdvanceObj.WardName}} - Tariff :{{selectedAdvanceObj.TariffName}}</span>
            </span>
            <span style="float: right;background: white;color: black;">
                <app-common-date [screenFrom]="screenFromString" (dateTimeEventEmitter)="getDateTime($event)">ri
                </app-common-date>
            </span>

            <button mat-icon-button [mat-dialog-close]="true" tabIndex="-1" aria-label="Close dialog">
                <mat-icon>close</mat-icon>
            </button>
        </div>

    </div>


    <mat-drawer-container class="example-container">
        <mat-drawer #drawer class="example-sidenav" mode="side" [opened]="true" style="width:17%;font-size:18px;">
            <form class="example-form" [formGroup]="Serviceform">

                <div class="col-md-6">
                    <mat-form-field appearance="outline">
                        <mat-label>Billing Class Name</mat-label>
                        <mat-select formControlName="ClassId">
                            <mat-option *ngFor="let Bclass of BillingClassCmbList" [value]="Bclass">
                                {{Bclass.ClassName}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>

                <div class="col-md-6">
                    <mat-form-field appearance="outline" style="width:90%;">
                        <input type="text" name="SrvcName" formControlName="SrvcName" placeholder="Service Name" matInput
                            [matAutocomplete]="auto" (input)="getServiceListCombobox()" required>

                        <mat-autocomplete #auto="matAutocomplete" [displayWith]="getOptionText" showPanel="true"
                            (optionsScroll)="onScroll()" (optionSelected)='getSelectedObj($event.option.value)'>
                            <mat-option *ngFor="let option of filteredOptions" [value]="option">
                                {{option.ServiceName}}
                            </mat-option>
                        </mat-autocomplete>
                        <mat-hint>
                            <span *ngIf="!noOptionFound">Select Service Name</span>
                            <span *ngIf="noOptionFound" style="color: #f44336;">No data
                                Found</span>
                        </mat-hint>
                        <mat-error *ngIf="Serviceform.get('SrvcName').hasError('required')">
                            Required field cannot be left blank
                        </mat-error>
                    </mat-form-field>

                </div>


                <div class="container">
                    <div class="row" style="display: flex;">
                        <div class="col-md-6" style="width: 48%;">
                            <mat-form-field appearance="outline">
                                <mat-label>Price</mat-label>
                                <input matInput [(ngModel)]="b_price" name="bPrice" (keyup)="calculateTotalAmt()"
                                    formControlName="price" required type="number">
                                <mat-error
                                    *ngIf="Serviceform.get('price').invalid && Serviceform.get('price').touched">
                                    Price is required</mat-error>
                            </mat-form-field>
                        </div>
                        <div class="col-md-6" style="width: 48%;">
                            <mat-form-field appearance="outline">
                                <mat-label>Qty</mat-label>
                                <input matInput [(ngModel)]="b_qty" name="bQty" (keyup)="calculateTotalAmt()"
                                    formControlName="qty" required type="number">
                                <mat-error
                                    *ngIf="Serviceform.get('qty').invalid && Serviceform.get('qty').touched">
                                    Qty is required</mat-error>
                            </mat-form-field>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <mat-form-field appearance="outline">
                        <mat-label>TotalAmt</mat-label>
                        <input matInput [(ngModel)]="b_totalAmount" name="bTotalAmt" readonly
                            formControlName="totalAmount" required>
                        <mat-error
                            *ngIf="Serviceform.get('totalAmount').invalid && Serviceform.get('totalAmount').touched">
                            TotalAmount is required</mat-error>
                    </mat-form-field>
                </div>
                <div class="col-md-6" *ngIf="isDoctor">
                 

                    <mat-form-field appearance="outline">
                        <mat-label>Doctor Name</mat-label>
                        <mat-select formControlName="DoctorID" placeholder="Bank" #singleSelect>
                            <mat-option>
                                <ngx-mat-select-search [formControl]="doctorFilterCtrl" [placeholderLabel]="'Search'"
                                    [noEntriesFoundLabel]="'No matching found'"></ngx-mat-select-search>
                            </mat-option>
                            <mat-option *ngFor="let element of filteredDoctor | async" [value]="element">
                                {{element.DoctorName}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                    <br>
                </div>
                <div class="container">
                    <div class="row" style="display: flex;">
                        <div class="col-md-6" style="width: 48%;">
                            <mat-form-field appearance="outline">
                                <mat-label>Disc %</mat-label>
                                <input matInput [(ngModel)]="formDiscPersc" name="formDiscPer"
                                    (keyup)="calculatePersc()" formControlName="discPer" type="number">
                            </mat-form-field>
                        </div>
                        <div class="col-md-6" style="width: 48%;">
                            <mat-form-field appearance="outline">
                                <mat-label>Disc Amt</mat-label>
                                <input matInput [(ngModel)]="b_disAmount" name="bDisAmount" formControlName="discAmount"
                                    type="number" (keyup)="calculatechargesDiscamt()">
                            </mat-form-field>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <mat-form-field appearance="outline">
                        <mat-label>NetAmount</mat-label>
                        <input matInput [(ngModel)]="b_netAmount" name="bNetAmount" readonly formControlName="netAmount"
                            required type="number">
                        <mat-error
                            *ngIf="Serviceform.get('netAmount').invalid && Serviceform.get('netAmount').touched">
                            NetAmount is required</mat-error>
                    </mat-form-field>
                </div>
                <div class="col-md-6">
                    <button class="next-btn" (click)="onSaveEntry()" [disabled]="Serviceform.invalid"
                        style="border-radius: 16px;">
                        <span style="display: flex;justify-content: center; ">
                            Save <mat-spinner *ngIf="isLoading == 'save'" class="spinner" [diameter]="25" color="white">
                            </mat-spinner>
                        </span>
                    </button>

                </div>
                &nbsp; &nbsp;
                <div>

                    <!-- <div fxLayout="row" fxLayout.gt-xs="row" fxLayoutGap="4px" fxLayoutAlign="space-between"
                        style=" height: 35px;background-color: #33b5e5">
                        <span style="font-size:18px; font-weight: 500; color:white;padding:5px;">Bill Summary </span>

                    </div> -->
                    <!-- <div style="padding: 5px;">

                        <mat-form-field appearance="outline" style="background: rgb(225, 240, 202);">
                            <mat-label style="font-weight: bold;font-size:20px;">Bill Amount</mat-label>
                            <input matInput [(ngModel)]="netPaybleAmt" formControlName="FinalAmount" name="netPaybleAmt"
                                readonly style="font-weight:500;font-size: 15px;text-align: right;">

                        </mat-form-field>
                        <mat-form-field appearance="outline" style="background: rgb(225, 240, 202);">
                            <mat-label style="font-weight: bold;font-size: 18px;">Advance Amount</mat-label>
                            <input matInput [(ngModel)]="netPaybleAmt" formControlName="FinalAmount" name="netPaybleAmt"
                                readonly style="font-weight:500;font-size: 15px;text-align: right;">

                        </mat-form-field>
                        <mat-form-field appearance="outline" style="background: rgb(225, 240, 202);">
                            <mat-label style="font-weight: bold;font-size: 18px;">Balance Amount</mat-label>
                            <input matInput [(ngModel)]="netPaybleAmt" formControlName="FinalAmount" name="netPaybleAmt"
                                readonly style="font-weight:500;font-size: 15px;text-align: right;">

                        </mat-form-field>
                        <mat-form-field appearance="outline" style="background: rgb(225, 240, 202);">
                            <mat-label style="font-weight: bold;font-size: 18px;">Pharmacy Amount</mat-label>
                            <input matInput [(ngModel)]="netPaybleAmt" formControlName="FinalAmount" name="netPaybleAmt"
                                readonly style="font-weight:500;font-size: 15px;text-align: right;">

                        </mat-form-field>
                    </div> -->
                </div>
            </form>
        </mat-drawer>



        <div class="example-sidenav-content" style="padding-left: 10px;">


            <mat-tab-group mat-align-tabs="start" class="tabs-group" mat-stretch-tabs style="margin-right: 7px">

                <mat-card>
                    <mat-tab label="Charges List" style="margin-left: 7px;">
                     
                        <div class="filter-div" style="display: flex; align-items: center;">
                            <mat-checkbox (change)="showAllFilter($event.value)" [(ngModel)]="isFilteredDateDisabled" aria-label="Remember Me" style="margin-right: 20px;">
                                Show All Charges
                            </mat-checkbox>
                            <div>
                                <form [formGroup]="Ipbillform">
                                    <mat-form-field appearance="outline" fxFlex>
                                        <mat-label>Choose date</mat-label>
                                        <input name="ChargeDate" matInput [matDatepicker]="picker" formControllName="ChargeDate"
                                        (dateChange)="getDatewiseChargesList($event.value)" [value]="currentDate" [readonly]="true">
                                        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                        <mat-datepicker #picker></mat-datepicker>
                                      </mat-form-field>
                                </form>
                            </div>

                            <span class="material-icons" (click)="drawer1.toggle()"
                                style="cursor: pointer;color: #6b6565;">
                                notifications_none
                            </span>


                        </div>
                        <mat-table #table matSort [dataSource]="dataSource" [@animateStagger]="{value:'50'}"
                            style="overflow:auto;" class="mat-data-table" class="table1">

                            <ng-container matColumnDef="checkbox" sticky>
                                <mat-header-cell *matHeaderCellDef mat-sort-header>
                                    <span class="material-icons" (click)="getChargesList()">
                                        cached
                                    </span>
                                </mat-header-cell>
                                <mat-cell *matCellDef="let contact">
                                    <mat-checkbox aria-label="Checked" (change)="tableElementChecked($event, contact)">
                                    </mat-checkbox>
                                </mat-cell>
                            </ng-container>
                            <ng-container matColumnDef="ChargesDate">
                                <mat-header-cell *matHeaderCellDef mat-sort-header>ChargesDate</mat-header-cell>
                                <mat-cell *matCellDef="let contact">
                                    {{contact.ChargesDate}}
                                </mat-cell>
                            </ng-container>

                            <ng-container matColumnDef="ServiceName">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm>Service Name
                                </mat-header-cell>
                                <mat-cell *matCellDef="let contact" fxShow.gt-sm>
                                    {{contact.ServiceName}}
                                </mat-cell>
                            </ng-container>

                            <ng-container matColumnDef="Price">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm>Price
                                </mat-header-cell>
                                <mat-cell *matCellDef="let contact" fxShow.gt-sm>

                                    <mat-form-field appearance="legacy">
                                        <input matInput [(ngModel)]="contact.Price" (keyup)="getTotalAmount(contact)">
                                        <span matPrefix>₹</span>

                                    </mat-form-field>
                                </mat-cell>
                            </ng-container>

                            <ng-container matColumnDef="Qty">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm>Qty
                                </mat-header-cell>
                                <mat-cell *matCellDef="let contact" fxShow.gt-sm>
                                    <mat-form-field appearance="legacy">
                                        <input matInput [(ngModel)]="contact.Qty" (keyup)="getTotalAmount(contact)">
                                    </mat-form-field>
                                </mat-cell>
                            </ng-container>

                            <ng-container matColumnDef="TotalAmt">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm>Total Amt
                                </mat-header-cell>
                                <mat-cell *matCellDef="let contact" fxShow.gt-sm>
                                    {{contact.TotalAmt | currency:'INR' }}
                                </mat-cell>
                            </ng-container>

                            <ng-container matColumnDef="DiscPer">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm>Disc %
                                </mat-header-cell>
                                <mat-cell *matCellDef="let contact" fxShow.gt-sm>
                                    {{contact.ConcessionPercentage}}
                                   
                                </mat-cell>
                            </ng-container>
                            <ng-container matColumnDef="DiscAmt">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm>Disc Amt
                                </mat-header-cell>
                                <mat-cell *matCellDef="let contact" fxShow.gt-sm>
                                    {{contact.ConcessionAmount | currency:'INR' }}
                                   
                                </mat-cell>
                            </ng-container>
                            <ng-container matColumnDef="NetAmount">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm>NetAmount
                                </mat-header-cell>
                                <mat-cell *matCellDef="let contact" fxShow.gt-sm>
                                    {{contact.NetAmount | currency:'INR' }}
                                </mat-cell>
                            </ng-container>
                            <ng-container matColumnDef="DoctorName">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm>ChargeDoctorName
                                </mat-header-cell>
                                <mat-cell *matCellDef="let contact" fxShow.gt-sm>
                                    {{contact.DoctorName}}
                                </mat-cell>
                            </ng-container>
                            <ng-container matColumnDef="ClassId">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm class="accent">ClassId
                                </mat-header-cell>
                                <mat-cell *matCellDef="let contact" fxShow.gt-sm>
                                    {{contact.ClassId}}
                                </mat-cell>
                            </ng-container>
                            <ng-container matColumnDef="ClassName">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm class="accent">ClassName
                                </mat-header-cell>
                                <mat-cell *matCellDef="let contact" fxShow.gt-sm>
                                    {{contact.ClassName}}
                                </mat-cell>
                            </ng-container>
                            <ng-container matColumnDef="ChargesAddedName">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm>ChargesAddedName
                                </mat-header-cell>
                                <mat-cell *matCellDef="let contact" fxShow.gt-sm>
                                    {{contact.ChargesAddedName}}
                                </mat-cell>
                            </ng-container>
                            <ng-container matColumnDef="buttons" stickyEnd>
                                <mat-header-cell *matHeaderCellDef class="table-actions" style="color: red;">Action
                                </mat-header-cell>
                                <mat-cell *matCellDef="let contact">
                                    <ng-container class="actions">
                                        <!-- <span class="material-icons" style="cursor: pointer;color: #5b5858;">
                                            edit
                                        </span> -->
                                        <span class="material-icons" style="cursor: pointer;color: #5b5858;"
                                            (click)="deleteTableRow(contact)">
                                            delete
                                        </span>
                                    </ng-container>

                                </mat-cell>
                            </ng-container>

                            <ng-container matColumnDef="loading">
                                <mat-header-cell *matFooterCellDef colspan="6" style="display: none;">
                                </mat-header-cell>
                            </ng-container>

                            <ng-container matColumnDef="noData">
                                <mat-footer-cell *matFooterCellDef colspan="6">

                                    <mat-spinner *ngIf="isLoadingStr=='loading'" [diameter]='30'>
                                    </mat-spinner>
                                    <span *ngIf="isLoadingStr=='no-data'">No data found...</span>
                                </mat-footer-cell>
                            </ng-container>

                            <mat-header-row class="accent" *matHeaderRowDef="displayedColumns; sticky: true">
                            </mat-header-row>
                            <mat-row *matRowDef="let contact; columns: displayedColumns;"
                                [ngClass]="{'row-yellow': contact.ServiceName == 'CBC'}"
                                [@animate]="{value:'*',params:{y:'100%'}}"></mat-row>
                            <mat-footer-row *matFooterRowDef="['loading']" [ngClass]="{'hide':dataSource!=null}">
                            </mat-footer-row>
                            <mat-footer-row *matFooterRowDef="['noData']"
                                [ngClass]="{'hide':!(dataSource!=null && dataSource.data.length==0)}">
                            </mat-footer-row>
                        </mat-table>
                    </mat-tab>


                </mat-card>

            </mat-tab-group>

            <div class="table-footer">

                <div class="net-amt">
                    <span class="net-amt-label">No of Items:</span>&nbsp;<span class="net-amt-value"
                        style="margin-right: 650px;">{{chargeslist.length }}</span>&nbsp;&nbsp;&nbsp;&nbsp;
                    <!-- <span class="net-amt-label">Net Amount:</span>&nbsp; -->
                    <span class="net-amt-value">{{getNetAmtSum(dataSource.data) | currency:'INR' }}</span>
                </div>
            </div>

        </div>

        <form class="example-form" [formGroup]="Ipbillform" style="font-size:20px;">
            <mat-card style="width: 100%;font-size: large;">
                <div class="footer-container" fxLayoutAlign="start center" style="padding:3px 3px 3px 3px;">

                    <div class="row row-container" style="width: 100%;">
                        <!-- <div class="som"> -->
                        <div class=" amount-section" style="width: 100%;margin-left: 5px;">
                            <div fxLayout="row">
                                <!-- class="cdk-visually-hidden" -->
                                <mat-form-field appearance="outline" style="margin-left: 5px;" fxFlex>
                                    <mat-label>Total Amount</mat-label>
                                    <input matInput [(ngModel)]="totalAmtOfNetAmt" name="totalAmtOfNetAmt"
                                        formControlName="TotalAmt" readonly
                                        style="font-weight:bold;font-size: 15px;text-align: right;">
                                </mat-form-field>&nbsp;

                                <mat-form-field appearance="outline" style=" margin-left: 15px;" fxFlex>
                                    <mat-label>%</mat-label>
                                    <input matInput name="Percentage" formControlName="Percentage" placeholder="0"
                                        (keyup)='CalAdmincharge()' type="number">
                                </mat-form-field>

                              
                                <mat-form-field appearance="outline" style="margin-right: 7px;" fxFlex>
                                    <mat-label>Concession Amount</mat-label>
                                    <input matInput [(ngModel)]="concessionAmtOfNetAmt" name="concessionAmtOfNetAmt"
                                        formControlName="concessionAmt" (keyup)="getNetAmount()"
                                        style="font-weight:bold;font-size: 15px;text-align: right;">
                                </mat-form-field>

                                <div *ngIf="ConShow">
                                    <mat-form-field appearance="outline" style=" margin-right: 7px;width: 250px; ">
                                        <mat-label>Concession Reason Type</mat-label>
                                        <mat-select formControlName="ConcessionId">
                                            <mat-option *ngFor="let Doc of ConcessionReasonList" [value]="Doc">
                                                {{Doc.ConcessionReason}}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </div>

                                <mat-form-field appearance="outline" fxFlex>
                                    <mat-label>Net Amount</mat-label>
                                    <input matInput [(ngModel)]="netPaybleAmt" formControlName="FinalAmount"
                                        name="netPaybleAmt" readonly required
                                        style="font-weight:bold;font-size: 15px;text-align: right;">
                                </mat-form-field>&nbsp;

                                <mat-form-field appearance="outline" style=" margin-right: 7px;width: 320px;">
                                    <mat-label>Remark</mat-label>
                                    <input matInput name="Remark" formControlName="Remark">
                                </mat-form-field>

                                <mat-form-field appearance="outline" style="width: 250px;">
                                    <mat-label>Cash Counter</mat-label>
                                    <mat-select formControlName="CashCounterId" required>
                                        <mat-option *ngFor="let m of CashCounterList" [value]="m">
                                            {{m.CashCounterName}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>


                            </div>

                            <div fxLayout="row" style="width: 100%;margin-top: 3px;">

                                <div style="float:right;">
                                    <mat-checkbox formControlName="GenerateBill" (checked)=true>
                                        Generate Bill
                                    </mat-checkbox>

                                    <button class="next-btn" (click)="getInterimData()" >Interim</button>

                                    <button class="next-btn" (click)="onSave()" [disabled]="Ipbillform.invalid">Save</button>

                                    <button class="footer-btn" (click)="onClose()" [routerLink]="'/ipd/add-billing'" style="border-radius: 16px;width: 80px;">Cancel</button>
                                </div>

                            </div>

                        </div>

                    </div>

                </div>
            </mat-card>
        </form>
    </mat-drawer-container>




</div>
<mat-drawer #drawer1 class="example-sidenav" id="showTable" mode="side" position="end"
    style="height: 530px !important;margin-top: 120px !important;margin-right: 40px;font-size: medium;">
    <mat-card>
        <div class="service-table1">
            <mat-table #table matSort [dataSource]="dataSource1" [@animateStagger]="{value:'50'}"
                style="overflow:auto;height: 540px !important;">

                <ng-container matColumnDef="ServiceName">
                    <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm>Service Name
                    </mat-header-cell>
                    <mat-cell *matCellDef="let contact" fxShow.gt-sm>
                        {{contact.ServiceName}}
                    </mat-cell>
                </ng-container>

                <!-- <ng-container matColumnDef="Price">
                <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm>Price
                </mat-header-cell>
                <mat-cell *matCellDef="let contact" fxShow.gt-sm>
                    <mat-form-field appearance="legacy">
                        <input matInput [(ngModel)]="contact.Price" (keyup)="getTotalAmount(contact)">
                        <span matPrefix>₹</span>
                    </mat-form-field>
                </mat-cell>
            </ng-container>

            <ng-container matColumnDef="Qty">
                <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm>Qty
                </mat-header-cell>
                <mat-cell *matCellDef="let contact" fxShow.gt-sm>
                    <mat-form-field appearance="legacy">
                        <input matInput [(ngModel)]="contact.Qty" (keyup)="getTotalAmount(contact)">
                    </mat-form-field>
                </mat-cell>
            </ng-container> -->

                <ng-container matColumnDef="loading">
                    <mat-footer-cell *matFooterCellDef colspan="6">
                        loading data...
                    </mat-footer-cell>
                </ng-container>

                <ng-container matColumnDef="noData">
                    <mat-footer-cell *matFooterCellDef colspan="6">
                        no data found...
                    </mat-footer-cell>
                </ng-container>

                <mat-header-row class="accent" *matHeaderRowDef="tableColumns; sticky: true">
                </mat-header-row>
                <mat-row *matRowDef="let contact; columns: tableColumns;" [@animate]="{value:'*',params:{y:'100%'}}"
                    (dblclick)="AddList(contact)">
                </mat-row>
                <mat-footer-row *matFooterRowDef="['loading']" [ngClass]="{'hide':dataSource1!=null}">
                </mat-footer-row>
                <mat-footer-row *matFooterRowDef="['noData']"
                    [ngClass]="{'hide':!(dataSource1!=null && dataSource1.data.length==0)}">
                </mat-footer-row>
            </mat-table>
        </div>
    </mat-card>
</mat-drawer>