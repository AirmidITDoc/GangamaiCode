<div id="contacts" class="page-layout simple left-sidebar inner-sidebar inner-scroll appointment-section mat-error-fix"
    dynamicTableHeight fusePerfectScrollbar>
    <mat-toolbar class="accent top-header" fusePerfectScrollbar>
        <div fxLayout="row" style="align-items: center;">
            <button mat-icon-button class="sidebar-toggle mr-12" fxHide.gt-sm (click)="toggleSidebar('app-main')">
                <mat-icon>menu</mat-icon>
            </button>
            <mat-icon class="logo-icon mr-16" [@animate]="{value:'*',params:{delay:'50ms',scale:'0.2'}}">account_box
            </mat-icon>

        </div>

        <!-- <div fxLayout="row" fxLayoutGap="5px">
            <app-common-date [screenFrom]="screenFromString" style="float:right"
                (dateTimeEventEmitter)="getDateTime($event)"></app-common-date>

        </div> -->
        <div class="gap-8" fxLayout="column" fxLayout.gt-xs="row" fxLayoutAlign="start center">
            <button mat-raised-button (click)="onAppointment()">New Appointment
            </button>
        </div>
    </mat-toolbar>


    <div id="contacts" class="page-layout simple left-sidebar inner-sidebar inner-scroll">
      
        <app-main class="accent-600" *ngIf="hasSelectedContacts" [@slideInTop]></app-main>
        <div class="content">
            <!-- SIDEBAR -->
            <fuse-sidebar name="app-main" position="left" lockedOpen="gt-sm" class="fuse-search-sidebar">
      
                <div class="accent header p-12" fxLayout="row" fxLayoutAlign="start center">
                    <span class="h5">Search Facility</span>
                    <!-- / USER -->
                </div>
                <!-- <div class="nav material2">
                    <form [formGroup]="myFilterform">
                        <div fxLayout="column" fxLayoutAlign="start none">
                            <mat-form-field appearance="outline">
                                <mat-label>Enter a date range</mat-label>
                                <mat-date-range-input [rangePicker]="picker">
                                    <input matStartDate formControlName="startdate" placeholder="Start date"
                                        (dateChange)="getVisitList()" required>
                                    <input matEndDate formControlName="enddate" placeholder="End date">
                                </mat-date-range-input>
                                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                <mat-date-range-picker #picker></mat-date-range-picker>
                            </mat-form-field>

                            <mat-form-field appearance="outline" fxFlex>
                                <mat-label>Reg No</mat-label>
                                <input name="RegNo" formControlName="RegNo" matInput (keyup)="getVisitList()" [(ngModel)]="RegNo">
                            </mat-form-field>

                            <mat-form-field appearance="outline" fxFlex>
                                <mat-label>First Name</mat-label>
                                <input name="FirstName" formControlName="FirstName" matInput (keyup)="getVisitList()"  [(ngModel)]="fname">
                            </mat-form-field>

                            <mat-form-field appearance="outline" fxFlex>
                                <mat-label>Last Name</mat-label>
                                <input name="LastName" formControlName="LastName" matInput (keyup)="getVisitList()"  [(ngModel)]="lname">
                            </mat-form-field>

                            <airmid-autocomplete label="DoctorId" formControlName="DoctorId" [value]="DoctorId"
                            [formGroup]="myFilterform" 
                            [validations]="getValidationdoctorMessages().DoctorId"
                            [mode]="autocompleteModedeptdoc" (selectDdlObject)="selectChangedeptdoc($event)">
                        </airmid-autocomplete>

                            <div class="action-buttons">
                                <button mat-raised-button (click)="onClear()" matTooltip="close">
                                    <mat-icon class="cleariconbutton">close</mat-icon>
                                </button>
                                <button mat-raised-button (click)="getVisitList()" matTooltip="search">
                                    <mat-icon class="searchiconbutton">search</mat-icon>
                                </button>
                            </div>
                        </div>
                    </form>
                </div> -->
            </fuse-sidebar>
            <!-- / SIDEBAR -->
            <!-- CENTER -->
            <!-- CENTER -->

            <div class="center p-12 pb-56" fxFlexAlign="start center">
                <div class="content-card" style="border-radius:4px; ">
                    <div fxFlexFill fxLayout="column" fxLayout.gt-xs="row" fxLayoutGap="30px">
                        <div fxFlex.gt-sm="100%" fxFlex>
                            <div fxLayout="column" class="gap-12">
                                <div class="info-badge-top pb-2 border-bottom" >
                                    <!-- "pill" class is used for rounded border -->
                                    <div fxLayout="row" fxLayoutAlign="start center" class="gap-8">
                                        <div style="color: blue;" fxLayout="row" fxLayoutAlign="start center"
                                            class="gap-4">
                                            <mat-icon class="pill blue-600 s-16">circle</mat-icon>
                                            <span class="blue-600-fg">Total Count : {{Vtotalcount}}</span>
                                        </div>
                                        <div style="color: green" fxLayout="row" fxLayoutAlign="start center"
                                            class="gap-4">
                                            <mat-icon class="pill green-600 s-16">circle</mat-icon>
                                            <span class="green-600-fg"> New Patient : {{VNewcount}}</span>
                                        </div>
                                        <div style="color: orange" fxLayout="row" fxLayoutAlign="start center"
                                            class="gap-4">
                                            <mat-icon class="pill orange-600 s-16">circle</mat-icon>
                                            <span class="orange-600-fg">FollowUp : {{VFollowupcount}}</span>
                                        </div>
                                        <div style="color: red" fxLayout="row" fxLayoutAlign="start center"
                                            class="gap-4">
                                            <mat-icon class="pill red-600 s-16">circle</mat-icon>
                                            <span class="red-600-fg">Bill Count : {{VBillcount}}</span>
                                        </div>
                                        <div style="color: red" fxLayout="row" fxLayoutAlign="start center"
                                            class="gap-4">
                                            <mat-icon class="pill red-600 s-16">circle</mat-icon>
                                            <span class="blue-600-fg">Cross Consultant Count :
                                                {{VCrossConscount}}</span>

                                        </div>

                                    </div>
                                </div>
                                <div class="table-wrapper">


                                    <!-- <mat-table #table matSort table="table1" [dataSource]="dataSource"
                                        class="appointment-table" id="app-table" (matSortChange)="getVisitList()"
                                        [@animateStagger]="{value:'50'}">

                                        <ng-container matColumnDef="visitId">
                                            <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm
                                                class="w-100">
                                                <span class="mat-header-text">visitId</span>
                                            </mat-header-cell>
                                            <mat-cell *matCellDef="let contact" fxShow.gt-sm class="w-100">
                                                <span> {{contact.visitId}} </span>
                                            </mat-cell>
                                        </ng-container>

                                        <ng-container matColumnDef="regId">
                                            <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm
                                                class="w-100">
                                                <span class="mat-header-text">RegId</span>
                                            </mat-header-cell>
                                            <mat-cell *matCellDef="let contact" fxShow.gt-sm class="w-100">
                                                <span> {{contact.regId}} </span>
                                            </mat-cell>
                                        </ng-container>
                                        <ng-container matColumnDef="prefixId">
                                            <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm
                                                class="w-100">
                                                <span class="mat-header-text">PrefixId</span>
                                            </mat-header-cell>
                                            <mat-cell *matCellDef="let contact" fxShow.gt-sm class="w-100">
                                                <span> {{contact.prefixId}} </span>
                                            </mat-cell>
                                        </ng-container>
                                        
                                
                                        <ng-container matColumnDef="patientName">
                                            <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm
                                                class="w-200">
                                                <span class="mat-header-text">Patient Name</span>
                                            </mat-header-cell>
                                            <mat-cell *matCellDef="let contact" fxShow.gt-sm class="w-200">
                                                <span> {{contact.patientName}} </span>
                                            </mat-cell>
                                        </ng-container>
                                        <ng-container matColumnDef="dateofBirth">
                                            <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm
                                                class="w-100">
                                                <span class="mat-header-text">DateofBirth</span>
                                            </mat-header-cell>
                                            <mat-cell *matCellDef="let contact" fxShow.gt-sm class="w-100">
                                                <span> {{contact.dateofBirth}} </span>
                                            </mat-cell>
                                        </ng-container>

                                        <ng-container matColumnDef="address">
                                            <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm
                                                class="w-100">
                                                <span class="mat-header-text">address</span>
                                            </mat-header-cell>
                                            <mat-cell *matCellDef="let contact" fxHide fxShow.gt-md class="w-100">
                                                <span> {{contact.address}}</span>
                                            </mat-cell>
                                        </ng-container>


                                        <ng-container matColumnDef="vistDateTime">
                                            <mat-header-cell *matHeaderCellDef mat-sort-header fxHide fxShow.gt-md
                                                class="w-100">
                                                <span class="mat-header-text">Date</span>
                                            </mat-header-cell>
                                            <mat-cell *matCellDef="let contact" fxHide fxShow.gt-md class="w-100">
                                                <span> {{contact.vistDateTime}}</span>
                                            </mat-cell>
                                        </ng-container>


                                        <ng-container matColumnDef="patientType">
                                            <mat-header-cell *matHeaderCellDef mat-sort-header fxHide class="w-100"
                                                fxShow.gt-md>
                                                <span class="mat-header-text">Patient Type</span>
                                            </mat-header-cell>
                                            <mat-cell *matCellDef="let contact" fxHide fxShow.gt-md class="w-100">
                                                <span> {{contact.patientType}}</span>
                                            </mat-cell>
                                        </ng-container>
                                        <ng-container matColumnDef="opdNo">
                                            <mat-header-cell *matHeaderCellDef mat-sort-header fxHide fxShow.gt-md
                                                class="w-100">
                                                <span class="mat-header-text">OPDNo</span>
                                            </mat-header-cell>
                                            <mat-cell *matCellDef="let contact" fxHide fxShow.gt-md class="w-100">
                                                <span> {{contact.opdNo}}</span>
                                            </mat-cell>
                                        </ng-container>

                                        <ng-container matColumnDef="departmentId">
                                            <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm
                                                class="w-200">
                                                <span class="mat-header-text">Department Name</span>
                                            </mat-header-cell>
                                            <mat-cell *matCellDef="let contact" fxShow.gt-sm class="w-200">
                                                <span> {{contact.departmentId}} </span>
                                            </mat-cell>
                                        </ng-container>



                                        <ng-container matColumnDef="companyName">
                                            <mat-header-cell *matHeaderCellDef mat-sort-header fxHide class="w-150"
                                                fxShow.gt-md>
                                                <span class="mat-header-text">Company Name</span>
                                            </mat-header-cell>
                                            <mat-cell *matCellDef="let contact" fxHide fxShow.gt-md class="w-150">
                                                <span>{{contact.companyName ? contact.companyName :
                                                    '--'}}</span>

                                                <button mat-icon-button
                                                    *ngIf="contact.companyName !=''; else nocompany "
                                                    matTooltip="Company" (click)="getEditCompany(contact)">
                                                    <mat-icon>edit</mat-icon>
                                                </button>
                                                <ng-template #nocompany>
                                                    <span>--</span>
                                                </ng-template>
                                            </mat-cell>
                                        </ng-container>

                                        <ng-container matColumnDef="tariffName">
                                            <mat-header-cell *matHeaderCellDef mat-sort-header fxHide fxShow.gt-md
                                                class="w-100">
                                                <span class="mat-header-text">Tariff Name</span>
                                            </mat-header-cell>
                                            <mat-cell *matCellDef="let contact" fxHide fxShow.gt-md class="w-100">
                                                <span> {{contact.tariffName}}</span>
                                            </mat-cell>
                                        </ng-container>


                                        <ng-container matColumnDef="buttons" stickyEnd>
                                            <mat-header-cell *matHeaderCellDef
                                                class="table-actions w-100">Action</mat-header-cell>
                                            <mat-cell *matCellDef="let contact" class="w-100">
                                                <div fxFlex="row" fxLayoutAlign="start center">
                                                    <button class="menu-btn" mat-icon-button
                                                        [matMenuTriggerFor]="moreMenu" aria-label="More"
                                                        (click)="$event.stopPropagation();">
                                                        <mat-icon class="secondary-text">more_vert</mat-icon>
                                                    </button>
                                                    <mat-menu #moreMenu="matMenu">
                                                        <ng-container *ngFor="let m of menuActions, let i=index">

                                                            <button mat-menu-item aria-label="remove"
                                                                (click)="getRecord(contact,m)">
                                                                <span>{{m}}</span>
                                                            </button>
                                                        </ng-container>
                                                    </mat-menu>
                                                </div>
                                            </mat-cell>
                                        </ng-container>

                                        <ng-container matColumnDef="loading">
                                            <mat-header-cell *matFooterCellDef colspan="6" style="display: none;">
                                            </mat-header-cell>
                                        </ng-container>

                                        <ng-container matColumnDef="noData">
                                            <mat-footer-cell *matFooterCellDef colspan="6">
                                                <span *ngIf="isLoadingStr=='no-data'">No data found...</span>
                                            </mat-footer-cell>
                                        </ng-container>

                                        <mat-header-row #table1HeaderRow class="accent min-width-1500"
                                            *matHeaderRowDef="displayedColumns; sticky: true">
                                        </mat-header-row>
                                        <mat-row class=" min-width-1500" #table1Row
                                            *matRowDef="let contact; columns: displayedColumns;"
                                            [ngClass]="contact.PatientType !== 'Self' ? 'self-row' : ''"
                                            [@animate]="{value:'*',params:{y:'100%'}}">
                                        </mat-row>

                                        <mat-footer-row *matFooterRowDef="['loading']"
                                            [ngClass]="{'hide':dataSource!=null}"></mat-footer-row>
                                        <mat-footer-row *matFooterRowDef="['noData']"
                                            [ngClass]="{'hide':!(dataSource!=null && dataSource.data.length==0)}"></mat-footer-row>
                                    </mat-table> -->

                                    <mat-paginator [pageSizeOptions]="[25, 50, 75, 100]" [pageSize]="25"
                                        showFirstLastButtons [length]="resultsLength" (page)="getVisitList()">
                                    </mat-paginator>

                                    <div style="display: none;">
                                        <div id="i-card" *ngIf="objICard">
                                            <div
                                                style="width: 225px;padding: 4px;margin: 0 auto;background-color: #1f1f1f;border-radius: 5px;position: relative;">
                                                <div
                                                    style="background-color: #fff;padding: 10px;border-radius: 10px;text-align: center;box-shadow: 0 0 1.5px 0px #b9b9b9;">
                                                    <div>
                                                        <img style="width: 100px;margin-top: 15px;"
                                                            src="/assets/images/logos/Airmid_NewLogo.jpeg">
                                                    </div>
                                                    <div>
                                                        <ngx-qrcode elementType="url" width="210" [value]="QrCode"
                                                            cssClass="profile-img" errorCorrectionLevel="L"
                                                            style="width: 80px;margin-top: 15px;" [alt]="QrCode">
                                                        </ngx-qrcode>
                                                    </div>
                                                    <h2 style="font-size: 15px;margin: 5px 0;">
                                                        {{objICard.PatientName}}</h2>
                                                    <h3 style="font-size: 12px;margin: 2.5px 0;font-weight: 300;">
                                                        {{objICard.Doctorname}}</h3>
                                                    <h3 style="font-size: 12px;margin: 2.5px 0;font-weight: 300;">
                                                        {{objICard.OPDNo}}</h3>
                                                    <hr>
                                                    <p><strong>{{objICard.HospitalName}}</strong></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- </div>
                                    </div> -->
                    <!-- CENTER -->
                </div>
                <!-- / USER -->
                <!-- / CENTER -->
                <!-- / CONTENT-->
            </div>
        </div>
    </div>

</div>