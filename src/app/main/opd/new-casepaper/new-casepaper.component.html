<div class="simple page-layout inner-scroll inner-sidebar left-sidebar">
    <mat-toolbar style="width: 100%;justify-content: space-between;">
        <div fxLayout="row" fxLayoutAlign="start center">
            <button mat-icon-button class="sidebar-toggle mr-12" style="color: white;">
                <mat-icon>menu</mat-icon>
            </button>
            <mat-icon class="logo-icon mr-16" [@animate]="{value:'*',params:{delay:'50ms',scale:'0.2'}}"
                style="color: white;">account_box
            </mat-icon>
            <span class="logo-text h1" [@animate]="{value:'*',params:{delay:'100ms',x:'-25px'}}" style="color: white;">
                Medical Record
            </span>
        </div>
        <div class="close-icon">
            <button mat-icon-button tabIndex="-1" [mat-dialog-close]="true" aria-label="Close dialog"
                matTooltip="Close">
                <mat-icon>close</mat-icon>
            </button>
        </div>
    </mat-toolbar>
    <div class="content">
        <div class="center p-12 pb-56" style="border-radius: 4px;">
            <div class="modal-card-container">

                <div fxFlexFill fxLayout="column" fxLayoutGap="8px">
                    <form [formGroup]="searchFormGroup">
                        <div fxLayout="row" fxLayoutAlign="space-between" fxLayoutGap="5px">

                            <airmid-autocomplete label="Search Reg No / Patient Name / Mobile No"
                                [formGroup]="searchFormGroup" formControlName="RegId"
                                placeholderText="Enter Patient Name/RegId.." fxFlex
                                ApiUrl="VisitDetail/search-patient?Keyword=" (selectionChange)="getSelectedObj($event)"
                                TextField="formattedText" ValueField="regId"></airmid-autocomplete>

                            <span style="margin-right: 40px;">
                                <app-common-date [screenFrom]="screenFromString"
                                    (dateTimeEventEmitter)="getDateTime($event)"></app-common-date>
                            </span>
                        </div>
                    </form>
                    <div class="modal-card-container">
                        <mat-card fxFlex.gt-sm="100%" fxFlex style="padding: 15px">
                            <div class="patient-info-sales my-8">
                                <div class="sales-patient-info-title">
                                    <span style="font-weight: 700;">
                                        Patient Information
                                    </span>
                                </div>
                                <hr>
                                <div class="Ipd-patient-info" fxFlexFill fxLayout="row"
                                    fxLayoutAlign="space-between center" class="patient-info">
                                    <div class="patient-sub">
                                        <div class="patient-info-row patient-info-1-111" fxLayout="row"
                                            fxLayoutAlign="space-between">
                                            <div fxLayout="column" fxLayoutGap="6px">
                                                <div class="patient-col">
                                                    <span class="patient-col-key">UHID No
                                                    </span>
                                                    <span>:</span>
                                                    <span class="patient-col-value">{{RegNo}}</span>
                                                </div>
                                                <div class="patient-col">
                                                    <span class="patient-col-key">Patient Name
                                                    </span>
                                                    <span>:</span>
                                                    <span class="patient-col-value">{{PatientName}}</span>
                                                </div>
                                                <div class="patient-col">
                                                    <span class="patient-col-key">Doctor Name</span>
                                                    <span>:</span>
                                                    <span class="patient-col-value">{{Doctorname}}</span>
                                                </div>
                                            </div>
                                            <div fxLayout="column" fxLayoutGap="6px">

                                                <div class="patient-col">
                                                    <span class="patient-col-key">OPD No</span>
                                                    <span>:</span>
                                                    <span class="patient-col-value">{{vOPDNo}}</span>
                                                </div>
                                                <div class="patient-col">
                                                    <span class="patient-col-key">Age | Sex
                                                    </span>
                                                    <span>:</span>
                                                    <span
                                                        class="patient-col-value">{{AgeYear}}Y|{{AgeMonth}}M|{{AgeDay}}
                                                        D | {{GenderName}}</span>
                                                </div>
                                                <div class="patient-col">
                                                    <span class="patient-col-key">Department</span>
                                                    <span>:</span>
                                                    <span class="patient-col-value">{{DepartmentName}}</span>
                                                </div>
                                            </div>
                                            <div fxLayout="column" fxLayoutGap="6px" style="margin-right: 100px;">

                                                <div class="patient-col">
                                                    <span class="patient-col-key">Patient Type | Tarrif
                                                    </span>
                                                    <span>:</span>
                                                    <span class="patient-col-value">{{PatientType}} |
                                                        {{Tarrifname}}</span>
                                                </div>
                                                <div class="patient-col">
                                                    <span class="patient-col-key">Company Name</span>
                                                    <span>:</span>
                                                    <span class="patient-col-value"
                                                        style="color: orange;">{{CompanyName}}</span>
                                                </div>
                                                <div class="patient-col">
                                                    <span class="patient-col-key">Ref-Doctor Name
                                                    </span>
                                                    <span>:</span>
                                                    <span class="patient-col-value">{{RefDocName}}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </mat-card>
                    </div>

                    <mat-tab-group>
                        <mat-tab label="Prescription">
                            <div class="content" style="overflow: auto;">
                                <div fxLayout="column" fxFlexFill fxLayoutGap="8px">

                                    <mat-card style="padding: 5px;">
                                        <form [formGroup]="caseFormGroup">
                                            <div fxLayout="column">
                                                <div class="prescription-title">
                                                    Vitals
                                                </div>
                                                <hr>

                                                <div fxLayout="row wrap" fxLayoutGap="10px">
                                                    <!-- Height [(ngModel)]="vHeight"  -->
                                                    <mat-form-field appearance="outline" fxFlex="11%">
                                                        <mat-label>Height</mat-label>
                                                        <input matInput formControlName="Height"
                                                            placeholder="Height in cm" required [maxLength]="20"
                                                            (keydown)="onEnterHeight($event)" OnlyNumber
                                                            (keyup)="getBMIcalculation()"
                                                            (keypress)="keyPressCharater($event)">
                                                        <span matSuffix style="font-size: x-large;">|</span>
                                                        <span matSuffix
                                                            style="margin-right: 10px; font-size: x-large;">cm</span>
                                                    </mat-form-field>

                                                    <!-- Weight [(ngModel)]="vWeight" -->
                                                    <mat-form-field appearance="outline" fxFlex="11%">
                                                        <mat-label>Weight</mat-label>
                                                        <input matInput formControlName="Weight"
                                                            placeholder="Weight in Kg" required [maxLength]="20"
                                                            (keydown)="onEnterWeight($event)" OnlyNumber
                                                            (keyup)="getBMIcalculation()"
                                                            (keypress)="keyPressCharater($event)">
                                                        <span matSuffix style="font-size: x-large;">|</span>
                                                        <span matSuffix
                                                            style="margin-right: 10px; font-size: x-large;">kg</span>
                                                    </mat-form-field>

                                                    <!-- BMI [(ngModel)]="vBMI"-->
                                                    <mat-form-field appearance="outline" fxFlex="11%">
                                                        <mat-label>BMI</mat-label>
                                                        <input matInput formControlName="BMI" placeholder="BMI"
                                                            readonly>
                                                    </mat-form-field>

                                                    <!-- BSL [(ngModel)]="vBSL"-->
                                                    <mat-form-field appearance="outline" fxFlex="11%">
                                                        <mat-label>BSL</mat-label>
                                                        <input matInput formControlName="BSL" placeholder="BSL"
                                                            [maxLength]="20" (keydown)="onEnterBSL($event)" OnlyNumber
                                                            (keypress)="keyPressCharater($event)">
                                                    </mat-form-field>

                                                    <!-- SpO2 [(ngModel)]="vSpO2" -->
                                                    <mat-form-field appearance="outline" fxFlex="11%">
                                                        <mat-label>SpO2</mat-label>
                                                        <input matInput formControlName="SpO2" placeholder="SpO2"
                                                            [maxLength]="20" (keydown)="onEnterSpO2($event)" OnlyNumber
                                                            (keypress)="keyPressCharater($event)">
                                                    </mat-form-field>

                                                    <!-- Pulse [(ngModel)]="vPulse" -->
                                                    <mat-form-field appearance="outline" fxFlex="11%">
                                                        <mat-label>Pulse</mat-label>
                                                        <input matInput formControlName="Pulse" placeholder="Pulse"
                                                            [maxLength]="10" (keydown)="onEnterPulse($event)" OnlyNumber
                                                            (keypress)="keyPressCharater($event)">
                                                        <span matSuffix style="font-size: x-large;">|</span>
                                                        <span matSuffix
                                                            style="margin-right: 10px; font-size: x-large;">bpm</span>
                                                    </mat-form-field>

                                                    <!-- BP [(ngModel)]="vBP"-->
                                                    <mat-form-field appearance="outline" fxFlex="12%">
                                                        <mat-label>BP</mat-label>
                                                        <input matInput formControlName="BP" placeholder="BP"
                                                            [maxLength]="10" (keydown)="onEnterBP($event)" OnlyNumber
                                                            (keypress)="keyPressOk($event)">
                                                        <span matSuffix style="font-size: x-large;">|</span>
                                                        <span matSuffix
                                                            style="margin-right: 10px; font-size: x-large;">mmHg</span>
                                                    </mat-form-field>

                                                    <!-- Temperature [(ngModel)]="vTemp" -->
                                                    <mat-form-field appearance="outline" fxFlex="11%">
                                                        <mat-label>Temp</mat-label>
                                                        <input matInput formControlName="Temp" placeholder="Temp"
                                                            [maxLength]="10" (keydown)="onEnterTemp($event)" OnlyNumber
                                                            (keypress)="keyPressCharater($event)">
                                                        <span matSuffix style="font-size: x-large;">|</span>
                                                        <!-- <span matSuffix style="margin-right: 10px; font-size: x-large;">°F</span> -->
                                                        <span matSuffix
                                                            style="margin-right: 10px; font-size: x-large;">F</span>
                                                    </mat-form-field>
                                                </div>

                                                <div fxLayout="column">

                                                    <form [formGroup]="caseFormGroup">
                                                        <div class="investigation-title">
                                                            <span style="font-weight: 700;">
                                                                Chief Complaint
                                                            </span>
                                                        </div>
                                                        <hr>
                                                        <div fxLayout="row">
                                                            <div fxFlex="40%">
                                                                <airmid-dropdown label="ChiefComplaint"
                                                                    formControlName="mAssignChiefComplaint"
                                                                    [formGroup]="caseFormGroup" #ddlChiefComplaint
                                                                    [IsMultiPle]="true" ValueField="complaintId"
                                                                    TextField="complaintDescr"
                                                                    ApiUrl="OPDPrescriptionMedical/get-ChiefComplaint"
                                                                    [ReqFullObj]="true"
                                                                    [value]="regObj.mAssignChiefComplaint"
                                                                    (selectionChange)="selectChangeCheifComplaint($event)">
                                                                </airmid-dropdown>
                                                            </div>
                                                            <mat-chip-listbox #chipList>
                                                                <mat-chip
                                                                    *ngFor="let item of caseFormGroup.value.mAssignChiefComplaint">
                                                                    {{ item.complaintDescr }} <mat-icon
                                                                        (click)="removeChiefComplaint(item)">close</mat-icon>
                                                                </mat-chip>
                                                            </mat-chip-listbox>
                                                        </div>
                                                    </form>

                                                    <!-- demo check -->
                                                    <!-- <form [formGroup]="caseFormGroup">
                                                         <mat-form-field appearance="outline" class="example-chip-list" fxFlex>
                                                        <mat-label>ChiefComplaint</mat-label>
                                                        <mat-chip-list #chipList aria-label="ChiefComplaint selection">
                                                            <mat-chip *ngFor="let item of addCheiflist1"
                                                                [selectable]="selectable" [removable]="removable"
                                                                (removed)="removeCheif1(item)">
                                                                {{item}}
                                                                <mat-icon *ngIf="removable"
                                                                    (click)="removeCheif1(item)">close</mat-icon>
                                                            </mat-chip>
                                                            <input style="height: 30px;"
                                                                placeholder="New ChiefComplaint..."
                                                                formControlName="mAssignChiefComplaint"
                                                                [matAutocomplete]="autoChips"
                                                                [matChipInputFor]="chipList"
                                                                (matChipInputTokenEnd)="addCheif1($event)" />
                                                        </mat-chip-list>
                                                        <mat-autocomplete #autoChips="matAutocomplete"
                                                            (optionSelected)="selectedobjCheif1($event.option.value)">
                                                            <mat-option
                                                                *ngFor="let option of filteredCheifComplaint | async"
                                                                [value]="option">
                                                                {{option.complaintDescr}}
                                                            </mat-option>
                                                        </mat-autocomplete>
                                                    </mat-form-field>
                                                        </form> -->

                                                    <!-- demo check -->

                                                    <form [formGroup]="caseFormGroup">
                                                        <div class="investigation-title">
                                                            <span style="font-weight: 700;">
                                                                Diagnosis
                                                            </span>
                                                        </div>
                                                        <hr>
                                                        <div fxLayout="row">
                                                            <div fxFlex="40%">
                                                                <airmid-dropdown label="Diagnosis"
                                                                    formControlName="mAssignDiagnosis"
                                                                    [formGroup]="caseFormGroup" #ddlDiagnosis
                                                                    [IsMultiPle]="true" ValueField="id"
                                                                    TextField="descriptionName"
                                                                    ApiUrl="OPDPrescriptionMedical/get-Dignosis"
                                                                    [ReqFullObj]="true"
                                                                    (selectionChange)="selectChangeDiagnosis($event)">
                                                                </airmid-dropdown>

                                                            </div>
                                                            <mat-chip-listbox #chipList>
                                                                <mat-chip
                                                                    *ngFor="let item of caseFormGroup.value.mAssignDiagnosis">
                                                                    {{ item.descriptionName }} <mat-icon
                                                                        (click)="removedignosis(item)">close</mat-icon>
                                                                </mat-chip>
                                                            </mat-chip-listbox>
                                                        </div>
                                                    </form>

                                                    <form [formGroup]="caseFormGroup">
                                                        <div class="investigation-title">
                                                            <span style="font-weight: 700;">
                                                                Examination
                                                            </span>
                                                        </div>
                                                        <hr>
                                                        <div fxLayout="row">
                                                            <div fxFlex="40%">
                                                                <airmid-dropdown label="Examination"
                                                                    formControlName="mAssignExamination"
                                                                    [formGroup]="caseFormGroup" #ddlExamination
                                                                    [IsMultiPle]="true"
                                                                    [value]="regObj.mAssignExamination"
                                                                    ValueField="examinationId"
                                                                    TextField="examinationDescr"
                                                                    ApiUrl="OPDPrescriptionMedical/get-Examination"
                                                                    [ReqFullObj]="true"
                                                                    (selectionChange)="selectChangeExamination($event)">
                                                                </airmid-dropdown>
                                                            </div>
                                                            <mat-chip-listbox #chipList>
                                                                <mat-chip
                                                                    *ngFor="let item of caseFormGroup.value.mAssignExamination">
                                                                    {{ item.examinationDescr }} <mat-icon
                                                                        (click)="removeExamination(item)">close</mat-icon>
                                                                </mat-chip>
                                                            </mat-chip-listbox>
                                                        </div>
                                                    </form>

                                                </div>
                                            </div>
                                        </form>
                                    </mat-card>

                                    <mat-card style="padding: 5px;">
                                        <div fxLayout="column" style="margin-left: 10px;">

                                            <div>
                                                <div class="prescription-title" fxLayoutAlign="space-between">
                                                    <span style="font-weight: 700;margin: 10px 10px 0px 5px">
                                                        Prescription List
                                                    </span>
                                                    <div fxLayout="row" fxLayoutGap="6px">
                                                        <button mat-raised-button (click)="getItemMaster()">
                                                            <mat-icon>add</mat-icon>
                                                            Drug</button>

                                                        <button mat-raised-button (click)="getDosemaster()">
                                                            <mat-icon>add</mat-icon>
                                                            Dose</button>

                                                        <button mat-raised-button
                                                            (click)="getPreviousPrescriptionlist()">
                                                            <mat-icon>first_page</mat-icon>
                                                            Load Previous</button>

                                                        <button mat-raised-button (click)="SaveTemplate()">
                                                            <mat-icon>save</mat-icon>
                                                            Save Template</button>
                                                    </div>
                                                </div>
                                                <hr>
                                                <form [formGroup]="MedicineItemForm">
                                                    <div fxLayout="row" class="gap-8">

                                                        <airmid-autocomplete label="Enter Drug Name"
                                                            [formGroup]="MedicineItemForm" formControlName="ItemId"
                                                            placeholderText="Enter Drug Name" fxFlex
                                                            ApiUrl="ItemMaster/GetItemListForPrescription?StoreId=2&ItemName="
                                                            (selectionChange)="selectChangeItemName($event)"
                                                            TextField="formattedText" ValueField="ItemId">
                                                        </airmid-autocomplete>

                                                        <airmid-dropdown label="Dose Name" formControlName="DoseId"
                                                            [formGroup]="MedicineItemForm"
                                                            [validations]="getValidationMessages().DoseId"
                                                            [mode]="autocompleteModeDose" [(ngModel)]="vdoseName"
                                                            (selectionChange)="selectChangeDoseName($event)">
                                                        </airmid-dropdown>

                                                        <mat-form-field appearance="outline" fxFlex="6%">
                                                            <mat-label>Day</mat-label>
                                                            <input type="text" OnlyNumber [(ngModel)]="vDay" name="Day"
                                                                required (keydown)="onEnterqty($event)"
                                                                formControlName="Day" matInput required #Day
                                                                (keypress)="keyPressAlphanumeric($event)">
                                                        </mat-form-field>

                                                        <!-- (keydown)="onEnterremark($event)" -->
                                                        <mat-form-field appearance="outline" fxFlex="20%">
                                                            <mat-label>Instruction</mat-label>
                                                            <input type="text" name="Instruction" [maxLength]="200"
                                                                [(ngModel)]="vInstruction" formControlName="Instruction"
                                                                matInput #Instruction (keydown)="onEnterremark($event)">
                                                        </mat-form-field>

                                                        <div class="input-add-button">
                                                            <div matTooltip="Select Drug to enable this button!!"
                                                                [matTooltipPosition]="'above'">
                                                                <button #addbutton class="btn btn-primary btn-with-icon"
                                                                    (click)="onAdd()">
                                                                    <span class="btn-icon">
                                                                        <mat-icon> add </mat-icon>
                                                                    </span>
                                                                    <span>Add</span>
                                                                </button>
                                                            </div>
                                                        </div>&nbsp;

                                                        <mat-divider [vertical]="true"></mat-divider>&nbsp;

                                                        <airmid-dropdown label="Template List"
                                                            formControlName="TemplateId" [formGroup]="MedicineItemForm"
                                                            [validations]="getValidationMessages().TemplateId"
                                                            [mode]="autocompleteModeTemplate"
                                                            (selectionChange)="selectChangeTemplateName($event)">
                                                        </airmid-dropdown>

                                                        <div class="input-add-button">
                                                            <div matTooltip="Select Drug to enable this button!!"
                                                                [matTooltipPosition]="'above'">
                                                                <button #addbutton class="btn btn-primary btn-with-icon"
                                                                    (click)="onTemplDetAdd()">
                                                                    <span class="btn-icon">
                                                                        <mat-icon> add </mat-icon>
                                                                    </span>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                            <div class="modal-card-container table-container fusePerfectScrollbar">
                                                <div class="table" fxFlex="100%">

                                                    <div class="airmid-table-container">
                                                        <mat-table matSort [dataSource]="dsItemList"
                                                            [@animateStagger]="{value:'50'}" class="airmid-table">

                                                            <ng-container matColumnDef="ItemName">
                                                                <mat-header-cell *matHeaderCellDef mat-sort-header
                                                                    fxHide fxShow.gt-sm>
                                                                    Drug Name</mat-header-cell>
                                                                <mat-cell *matCellDef="let element" fxHide fxShow.gt-sm>
                                                                    <span> {{element.DrugName ||
                                                                        element.drugName}}</span>
                                                                    <!-- <span> {{element.DrugName || vDrugName}}</span> -->
                                                                </mat-cell>
                                                            </ng-container>

                                                            <ng-container matColumnDef="ItemGenericName">
                                                                <mat-header-cell *matHeaderCellDef mat-sort-header
                                                                    fxHide fxShow.gt-sm class="w-300">
                                                                    ItemGenericName
                                                                </mat-header-cell>

                                                                <mat-cell *matCellDef="let element; let in = index"
                                                                    fxHide fxShow.gt-sm class="w-300">
                                                                    <!-- Display text when not in edit mode -->
                                                                    <span *ngIf="editingIndex1 !== in">
                                                                        {{ element.GenericName || element.genericName }}
                                                                        <!-- {{ element.GenericName || vItemGN }} -->
                                                                        <mat-icon (click)="editItem(in, element)"
                                                                            class="edit-icon">edit</mat-icon>
                                                                    </span>

                                                                    <!-- Show dropdown and save button when in edit mode -->
                                                                    <div *ngIf="editingIndex1 === in"
                                                                        style="display: flex; align-items: center; gap: 10px; width: 300px;">
                                                                        <airmid-dropdown label="ItemGeneric Name"
                                                                            fxFlex="80%"
                                                                            formControlName="ItemGenericNameId"
                                                                            [formGroup]="MedicineItemForm"
                                                                            [mode]="autocompleteModeItemGeneric"
                                                                            (selectionChange)="selectChangeItemGenericName($event)">
                                                                        </airmid-dropdown>

                                                                        <button mat-icon-button
                                                                            (click)="OnSaveEditGeneric(element)"
                                                                            matTooltip="Save">
                                                                            <mat-icon
                                                                                class="active-icon green-600 s-16">check</mat-icon>
                                                                        </button>

                                                                        <button mat-icon-button
                                                                            (click)="GenericdisableEditing(element)"
                                                                            matTooltip="Close">
                                                                            <mat-icon
                                                                                class="active-icon red-600 s-16">close</mat-icon>
                                                                        </button>
                                                                    </div>
                                                                </mat-cell>
                                                            </ng-container>

                                                            <ng-container matColumnDef="DoseName">
                                                                <mat-header-cell *matHeaderCellDef mat-sort-header
                                                                    fxHide fxShow.gt-sm class="w-300">
                                                                    Dose Name
                                                                </mat-header-cell>

                                                                <mat-cell *matCellDef="let element; let i = index"
                                                                    fxHide fxShow.gt-sm class="w-300">

                                                                    <span *ngIf="editingIndex !== i">
                                                                        {{ element.DoseName || element.doseName }}
                                                                        <!-- {{ element.DoseName || vDoseName }} -->
                                                                        <mat-icon (click)="editDose(i, element)"
                                                                            class="edit-icon">edit</mat-icon>
                                                                    </span>

                                                                    <div *ngIf="editingIndex === i"
                                                                        style="display: flex; align-items: center; gap: 5px; width: 300px;">
                                                                        <airmid-dropdown formControlName="DoseId1"
                                                                            fxFlex="50%" [formGroup]="MedicineItemForm"
                                                                            [mode]="autocompleteModeDose"
                                                                            (selectionChange)="selectChangeDoseName($event)">
                                                                        </airmid-dropdown>

                                                                        <button mat-icon-button
                                                                            (click)="OnSaveEditDose(element)"
                                                                            matTooltip="Save">
                                                                            <mat-icon
                                                                                class="active-icon green-600 s-16">check</mat-icon>
                                                                        </button>

                                                                        <button mat-icon-button
                                                                            (click)="DosedisableEditing(i)"
                                                                            matTooltip="Close">
                                                                            <mat-icon
                                                                                class="active-icon red-600 s-16">close</mat-icon>
                                                                        </button>
                                                                    </div>
                                                                </mat-cell>
                                                            </ng-container>

                                                            <ng-container matColumnDef="Days">
                                                                <mat-header-cell *matHeaderCellDef mat-sort-header
                                                                    fxHide fxShow.gt-sm>Days</mat-header-cell>
                                                                <mat-cell *matCellDef="let element" fxHide fxShow.gt-sm>
                                                                    <mat-form-field appearance="fill"
                                                                        floatLabel="never">
                                                                        <input matInput
                                                                            [(ngModel)]="element.Days || element.days"
                                                                            type="number" OnlyNumber>
                                                                    </mat-form-field>
                                                                </mat-cell>
                                                            </ng-container>
                                                            <!-- [(ngModel)]="element.Days || vDayys" -->

                                                            <ng-container matColumnDef="Remark">
                                                                <mat-header-cell *matHeaderCellDef mat-sort-header
                                                                    fxShow.gt-sm>Instruction
                                                                </mat-header-cell>
                                                                <mat-cell *matCellDef="let element" fxShow.gt-sm>
                                                                    <mat-form-field appearance="fill"
                                                                        floatLabel="never">
                                                                        <input matInput [maxLength]="200"
                                                                            [(ngModel)]="element.Instruction || element.instruction"
                                                                            type="text">
                                                                    </mat-form-field>
                                                                </mat-cell>
                                                            </ng-container>
                                                            <!-- [(ngModel)]="element.Instruction || vInst" -->

                                                            <ng-container matColumnDef="Action" stickyEnd>
                                                                <mat-header-cell *matHeaderCellDef
                                                                    class="table-actions">Action
                                                                </mat-header-cell>
                                                                <mat-cell *matCellDef="let contact">
                                                                    <ng-container class="actions">
                                                                        <mat-icon
                                                                            (click)="deleteTableRow($event ,contact)"
                                                                            color="warn">
                                                                            delete
                                                                        </mat-icon>
                                                                    </ng-container>
                                                                </mat-cell>
                                                            </ng-container>

                                                            <mat-header-row class="accent"
                                                                *matHeaderRowDef="displayedItemColumn; sticky: true">
                                                            </mat-header-row>
                                                            <mat-row *matRowDef="let row; columns: displayedItemColumn;"
                                                                class="element"
                                                                [@animate]="{value:'*',params:{y:'100%'}}"></mat-row>
                                                        </mat-table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </mat-card>

                                    <mat-card fxLayout="column" style="padding: 5px;">
                                        <form [formGroup]="caseFormGroup">
                                            <div class="investigation-title">
                                                <span style="font-weight: 700;">
                                                    Request For Test
                                                </span>
                                            </div>
                                            <hr>
                                            <div fxLayout="row">
                                                <div fxFlex="40%">

                                                    <airmid-dropdown label="Service" formControlName="mAssignService"
                                                        [formGroup]="caseFormGroup" #ddlService [IsMultiPle]="true"
                                                        ValueField="serviceId" TextField="serviceName"
                                                        ApiUrl="BillingService/GetServiceListwithGroupWise?TariffId=1&ClassId=1&IsPathRad=2&ServiceName=%"
                                                        [ReqFullObj]="true"
                                                        (selectionChange)="selectChangeServiceName($event)">
                                                    </airmid-dropdown>

                                                </div>

                                                <mat-chip-listbox #chipList>
                                                    <mat-chip *ngFor="let item of caseFormGroup.value.mAssignService">
                                                        {{ item.serviceName }} <mat-icon
                                                            (click)="removeService(item)">close</mat-icon>
                                                    </mat-chip>
                                                </mat-chip-listbox>
                                            </div>
                                        </form>
                                    </mat-card>

                                    <mat-card fxLayout="column" style="padding: 5px;">
                                        <form [formGroup]="MedicineItemForm">
                                            <div class="consultunt-title">
                                                <span style="font-weight: 700;">
                                                    Refer To Another Doctor
                                                </span>
                                            </div>
                                            <hr>
                                            <div fxLayout="row" fxLayoutGap="6px">
                                                <airmid-dropdown label="Doctor Name" formControlName="DoctorID"
                                                    fxFlex="35%" [formGroup]="MedicineItemForm"
                                                    [validations]="getValidationMessages().DoctorID"
                                                    [mode]="autocompleteModeDoctor"
                                                    (selectionChange)="selectChangeDoctorName($event)">
                                                </airmid-dropdown>

                                            </div>
                                        </form>
                                    </mat-card>

                                    <mat-card fxLayout="column" style="padding: 5px;">
                                        <form [formGroup]="MedicineItemForm">
                                            <div class="consultunt-title">
                                                <span style="font-weight: 700;">
                                                    Follow Up Visit Date
                                                </span>
                                            </div>
                                            <hr>
                                            <div fxLayout="row" fxLayoutGap="6px">
                                                <div fxFlex="13%">
                                                    <mat-button-toggle-group [(ngModel)]="dateStyle"
                                                        (change)="OnChangeDobType($event)" aria-label="Font Style"
                                                        formControlName="dateStylebtn">
                                                        <!-- <mat-button-toggle value="Date">Date</mat-button-toggle> -->
                                                        <mat-button-toggle value="Day">Day</mat-button-toggle>
                                                        <mat-button-toggle value="Month">Month</mat-button-toggle>
                                                        <mat-button-toggle value="Year">Year</mat-button-toggle>
                                                    </mat-button-toggle-group>
                                                </div>

                                                <mat-form-field appearance="outline" fxFlex="10%"
                                                    *ngIf="dateStyle=='Day'  || dateStyle=='Month' || dateStyle=='Year'">
                                                    <mat-label *ngIf="dateStyle=='Day'">Follow Up Days</mat-label>
                                                    <mat-label *ngIf="dateStyle=='Month'">Follow Up Month</mat-label>
                                                    <mat-label *ngIf="dateStyle=='Year'">Follow Up Year</mat-label>
                                                    <input name="Days" formControlName="Days" placeholder="Days"
                                                        matInput [(ngModel)]="vDays" (keyup)="onDaysChange()">
                                                </mat-form-field>

                                                <mat-form-field appearance="outline" fxFlex="20%">
                                                    <mat-label>Follow Up Date</mat-label>
                                                    <input matInput [matDatepicker]="picker1"
                                                        placeholder="Choose a date" formControlName="start"
                                                        [(ngModel)]="specificDate">
                                                    <mat-datepicker-toggle matSuffix
                                                        [for]="picker1"></mat-datepicker-toggle>
                                                    <mat-datepicker #picker1></mat-datepicker>
                                                </mat-form-field>

                                            </div>
                                        </form>
                                    </mat-card>
                                    <mat-card fxLayout="column" style="padding: 5px;">
                                        <div class="advice-title">
                                            <span style="font-weight: 700;">Advice</span>
                                        </div>
                                        <hr />

                                        <!-- 🎯 Row: Remark + Mic (inside form) + Language (outside form) -->
                                        <div fxLayout="row" fxLayoutGap="10px" fxLayoutAlign="start center">

                                            <!-- ✅ Form starts here -->
                                            <form [formGroup]="MedicineItemForm" fxFlex>
                                                <mat-form-field appearance="outline" style="width: 100%;">
                                                    <mat-label>Remark</mat-label>
                                                    <textarea rows="1" formControlName="Remark" placeholder="Remark"
                                                        matInput></textarea>

                                                    <!-- 🎤 Mic button -->
                                                    <button mat-icon-button matSuffix (click)="onMicToggle()"
                                                        [color]="speechService.isListening ? 'warn' : 'primary'"
                                                        type="button">
                                                        <i
                                                            [class]="speechService.isListening ? 'fas fa-microphone-slash' : 'fas fa-microphone'"></i>
                                                    </button>
                                                </mat-form-field>
                                            </form>

                                            <!-- ✅ Language dropdown outside form -->
                                            <mat-form-field appearance="outline" style="min-width: 180px;">
                                                <mat-label>Language</mat-label>
                                                <mat-select [(ngModel)]="selectedLang"
                                                    (selectionChange)="onLangChange()" name="languageSelect">
                                                    <mat-option *ngFor="let lang of languages" [value]="lang.code">
                                                        {{ lang.label }}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>
                                        </div>
                                    </mat-card>
                                    <div fxLayout="row" fxLayoutAlign="space-between">
                                        <form [formGroup]="caseFormGroup" fxLayoutAlign="space-between">
                                            <mat-radio-group aria-label="Select an option"
                                                formControlName="LetteHeadRadio" (change)="LetterheadFilter($event)"
                                                fxLayout="row">
                                                <mat-radio-button value="LetterHead"> Letter Head</mat-radio-button>
                                                <mat-radio-button value="NormalHead">Print Normal</mat-radio-button>
                                            </mat-radio-group>

                                            <mat-radio-group aria-label="Select an option"
                                                formControlName="LangaugeRadio" (change)="onChangeLangaugeRadio($event)"
                                                fxLayout="row">
                                                <mat-radio-button value="false">Print In Marathi</mat-radio-button>
                                                <mat-radio-button value="true">Print In English</mat-radio-button>
                                            </mat-radio-group>
                                        </form>

                                        <div class="sales-footer-buttons gap-6" fxLayout="row">
                                            <button class="btn btn-danger-outline" (click)="onClear()">Reset</button>
                                            <button class="btn btn-primary " (click)="onSave()">Save</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </mat-tab>

                        <!-- new visit info -->
                        <mat-tab label="Previous Visit Info">
                            <ng-template mat-tab-label>
                                Previous Visit Info
                            </ng-template>
                            <div class="center p-12">
                                <div fxlayout="row" fxLayout="column" fxFlexFill fxLayoutGap="10px">

                                    <div fxLayoutAlign="end">
                                        <button mat-raised-button>
                                            <mat-icon matTooltip="Email Menu">mail</mat-icon>Email
                                        </button>
                                    </div>

                                    <div *ngFor="let visitId of uniqueDates">
                                        <mat-card style="padding: 6px;">
                                            <div fxLayout="column" fxLayoutGap="6px">
                                                <div>
                                                    <div class="visit-info-title" fxLayoutAlign="space-between">
                                                        <span style="font-weight: 900;color: blueviolet;">
                                                            <!-- Visit Date : {{ date | date: 'dd/MM/YYYY' }} -->
                                                            Visit ID :- {{visitId}}
                                                            <!-- {{ date | date:' fullDate'}}  -->
                                                        </span>
                                                        <span style="font-weight: 900;color: blueviolet;">
                                                            Visit Information
                                                        </span>
                                                        <div class="gap-12">
                                                            <button mat-raised-button
                                                                (click)="viewgetOpprescriptionReportPdf()"
                                                                matTooltip="Print">
                                                                <mat-icon>print</mat-icon>LetterHead
                                                            </button>

                                                            <button mat-raised-button
                                                                (click)="viewgetOpprescriptionReportPdf()"
                                                                matTooltip="Print">
                                                                <mat-icon>print</mat-icon>Without LetterHead
                                                            </button>

                                                            <button mat-raised-button>
                                                                <img width="25" height="8px"
                                                                    src="assets/images/logos/WhatsApp.png"
                                                                    (click)="getWhatsappshareSales()"
                                                                    matTooltip="Send Prescription Details On WhatsApp">
                                                            </button>

                                                        </div>
                                                    </div>
                                                    <hr>
                                                    <div *ngFor="let patient of getPatientsForDate(visitId)">
                                                        <div class="Ipd-patient-info" fxFlexFill fxLayout="row"
                                                            fxLayoutAlign="space-between center" class="patient-info">
                                                            <div class="patient-sub">
                                                                <div class="patient-info-row patient-info-1-111 pt-4"
                                                                    fxLayout="column" fxLayoutAlign="space-between">
                                                                    <div fxLayout="row" fxLayoutAlign="space-between">
                                                                        <div class="patient-col">
                                                                            <span class="patient-col-key">Height
                                                                            </span>
                                                                            <span>:</span>
                                                                            <span
                                                                                class="patient-col-value">{{patient.pHeight}}
                                                                                <span matSuffix
                                                                                    style="font-size: 13px;"> |
                                                                                    cm</span>
                                                                            </span>

                                                                        </div>

                                                                        <div class="patient-col">
                                                                            <span class="patient-col-key">Weight
                                                                            </span>
                                                                            <span>:</span>
                                                                            <span
                                                                                class="patient-col-value">{{patient.pWeight}}
                                                                                <span matSuffix style="font-size:13px;">
                                                                                    | Kg</span>
                                                                            </span>
                                                                        </div>

                                                                        <div class="patient-col">
                                                                            <span class="patient-col-key">BMI</span>
                                                                            <span>:</span>
                                                                            <span
                                                                                class="patient-col-value">{{patient.BMI}}</span>
                                                                        </div>

                                                                        <div class="patient-col">
                                                                            <span class="patient-col-key">SPO2
                                                                            </span>
                                                                            <span>:</span>
                                                                            <span
                                                                                class="patient-col-value">{{patient.spO2}}</span>
                                                                        </div>

                                                                        <div class="patient-col">
                                                                            <span class="patient-col-key">BSL</span>
                                                                            <span>:</span>
                                                                            <span
                                                                                class="patient-col-value">{{patient.bsl}}</span>
                                                                        </div>

                                                                        <div class="patient-col">
                                                                            <span class="patient-col-key">Pulse
                                                                            </span>
                                                                            <span>:</span>
                                                                            <span
                                                                                class="patient-col-value">{{patient.pulse}}
                                                                                <span matSuffix
                                                                                    style="font-size: 13px;"> |
                                                                                    bpm</span>
                                                                            </span>
                                                                        </div>

                                                                        <div class="patient-col">
                                                                            <span class="patient-col-key">BP</span>
                                                                            <span>:</span>
                                                                            <span
                                                                                class="patient-col-value">{{patient.bp}}
                                                                                <span matSuffix
                                                                                    style="font-size: 13px;"> |
                                                                                    mmHg</span>
                                                                            </span>
                                                                        </div>

                                                                        <div class="patient-col">
                                                                            <span
                                                                                class="patient-col-key">Temprature</span>
                                                                            <span>:</span>
                                                                            <span
                                                                                class="patient-col-value">{{patient.temp}}
                                                                                <span matSuffix
                                                                                    style="font-size: 13px;"> | F</span>
                                                                            </span>
                                                                        </div>
                                                                    </div>
                                                                    <div
                                                                        style="border: 1px solid rgb(203, 203, 203);width: 100%;">
                                                                    </div>
                                                                    <div>
                                                                        <div fxLayout="row" fxLayoutGap="6px">
                                                                            <div class="patient-col">
                                                                                <span
                                                                                    class="patient-col-key">ChiefComplaint
                                                                                </span>
                                                                                <span>:</span>
                                                                                <span
                                                                                    class="patient-col-value">{{patient.chiefComplaint}}</span>
                                                                            </div>
                                                                        </div>
                                                                        <div fxLayout="column" fxLayoutGap="6px">
                                                                            <div class="patient-col">
                                                                                <span
                                                                                    class="patient-col-key">Diagnosis</span>
                                                                                <span>:</span>
                                                                                <span
                                                                                    class="patient-col-value">{{patient.diagnosis}}</span>
                                                                            </div>
                                                                        </div>
                                                                        <div fxLayout="column" fxLayoutGap="6px">
                                                                            <div class="patient-col">
                                                                                <span
                                                                                    class="patient-col-key">Examination
                                                                                </span>
                                                                                <span>:</span>
                                                                                <span
                                                                                    class="patient-col-value">{{patient.examination}}</span>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div style="border: 1px solid rgb(203, 203, 203);width: 100%;"></div>
                                                <div fxFlex.gt-sm="100%" fxlayout="column">
                                                    <div class="prescription-title">
                                                        <span style="font-weight: 700;">
                                                            Prescription List
                                                        </span>
                                                    </div>
                                                    <hr>
                                                    <table mat-table [dataSource]="getFirstPatientForDate(visitId)"
                                                        class="mat-table-1 h-220" [@animateStagger]="{value:'50'}"
                                                        style="width: 100%;overflow: auto">

                                                        <ng-container matColumnDef="ItemName">
                                                            <mat-header-cell *matHeaderCellDef>ItemName
                                                            </mat-header-cell>
                                                            <mat-cell *matCellDef="let patient">
                                                                <span> {{patient.drugName}}</span>
                                                            </mat-cell>
                                                        </ng-container>

                                                        <ng-container matColumnDef="DoseName">
                                                            <mat-header-cell *matHeaderCellDef>DoseName
                                                            </mat-header-cell>
                                                            <mat-cell *matCellDef="let patient">
                                                                <span> {{patient.doseName}}</span>
                                                            </mat-cell>
                                                        </ng-container>

                                                        <ng-container matColumnDef="Days">
                                                            <mat-header-cell *matHeaderCellDef>Days
                                                            </mat-header-cell>
                                                            <mat-cell *matCellDef="let patient">
                                                                <span> {{patient.days}}</span>
                                                            </mat-cell>
                                                        </ng-container>

                                                        <ng-container matColumnDef="Remark">
                                                            <mat-header-cell *matHeaderCellDef>Instruction
                                                            </mat-header-cell>
                                                            <mat-cell *matCellDef="let patient">
                                                                <span> {{patient.instruction}}</span>
                                                            </mat-cell>
                                                        </ng-container>

                                                        <ng-container matColumnDef="loading">
                                                            <mat-footer-cell *matFooterCellDef colspan="6">
                                                                loading data...
                                                            </mat-footer-cell>
                                                        </ng-container>

                                                        <ng-container matColumnDef="noData">
                                                            <mat-footer-cell *matFooterCellDef colspan="6">
                                                                <span>No Data Found</span>
                                                            </mat-footer-cell>
                                                        </ng-container>

                                                        <mat-header-row class="accent"
                                                            *matHeaderRowDef="displayedpreviousColumn; sticky: true">
                                                        </mat-header-row>
                                                        <mat-row *matRowDef="let row; columns: displayedpreviousColumn;"
                                                            class="element"
                                                            [@animate]="{value:'*',params:{y:'100%'}}"></mat-row>
                                                    </table>
                                                </div>
                                            </div>
                                        </mat-card>
                                    </div>
                                </div>
                            </div>
                        </mat-tab>
                    </mat-tab-group>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- <h2>Speech Recognition (Native Web API)</h2>

<label for="language">Choose a language:</label>
<select id="language" [(ngModel)]="selectedLang">
  <option value="en-US">English (US)</option>
  <option value="hi-IN">Hindi</option>
  <option value="mr-IN">Marathi</option>
</select>

<br /><br />
<button (click)="startRecognition()" [disabled]="isListening">
  <i class="fas fa-microphone"></i> Start
</button>

<button (click)="stopRecognition()" [disabled]="!isListening">
  <i class="fas fa-microphone-slash"></i> Stop
</button>

<label for="speechInput">Speech to Input:</label>
<input type="text" id="speechInput" [(ngModel)]="transcript" placeholder="Speak something..." /> -->


<!-- Language selection -->
<!-- <select [(ngModel)]="selectedLang">
  <option value="en-US">English</option>
  <option value="hi-IN">Hindi</option>
  <option value="mr-IN">Marathi</option>
</select> -->

<!-- Input field for speech transcript -->
<!-- <input type="text" [(ngModel)]="transcript" placeholder="Speak something..." /> -->

<!-- Single toggle button with icon -->
<!-- <button (click)="toggleRecognition()">
  <i [class]="isListening ? 'fas fa-microphone-slash' : 'fas fa-microphone'"></i>
  {{ isListening ? 'Stop' : 'Start' }}
</button> -->