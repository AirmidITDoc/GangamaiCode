<div class="page-layout simple inner-sidebar inner-scroll right-sidebar" style="height: 100%;" fusePerfectScrollbar
    dynamicTableHeight>
    <mat-toolbar class="top-header accent">
        <div fxLayout="row" fxLayoutAlign="start center" class="top-header-info">
            <button mat-icon-button class="sidebar-toggle ">
                <mat-icon>menu</mat-icon>
            </button>
            <mat-icon class="logo-icon" [@animate]="{value:'*',params:{delay:'50ms',scale:'0.2'}}">account_box
            </mat-icon>
            <span class="logo-text h1" [@animate]="{value:'*',params:{delay:'100ms',x:'-25px'}}">
                Stock Adjustment
            </span>
        </div>
    </mat-toolbar>
    <div class="layout-body p-12">
        <div class="layout-body-container center">
            <div fxLayout="column">
                <div class="layout-card-container" style="height: 80px;">
                    <form [formGroup]="StoreFrom" class="mat-error-fix">

                        <div fxLayout.gt-xs="row" fxLayout="column" fxLayoutAlign="start" class="gap-8">
                            <div fxLayout="row wrap" fxFlex fxLayoutGap="14px 0px grid">

                                <div fxFlex="25%" fxFlex.xs="100%" fxFlex.sm="35%">
                                    <airmid-dropdown label="Store Name" formControlName="StoreId" [readonly]="true"
                                        [formGroup]="StoreFrom" [mode]="autocompletestore"
                                        (selectionChange)="selectChangeStore($event)">
                                    </airmid-dropdown>
                                </div>

                                <div fxFlex="35%" fxFlex.xs="100%" fxFlex.sm="35%">


                                    <airmid-autocomplete label="Item Name (enter 2 char)" [formGroup]="StoreFrom"
                                        formControlName="ItemID" placeholderText="Item Name (enter 2 char)" fxFlex="60%"
                                        ApiUrl="ItemMaster/GetItemListForGRNOrPO?StoreId=2&ItemName="
                                        (selectionChange)="selectChangeItem($event)" TextField="formattedText"
                                        ValueField="itemId" (onClearSelection)="resetFormItem()"></airmid-autocomplete>

                                    <div class="action-button-container" style="margin-left: 20px;">
                                        <div class="button-row-group">
                                            <button type="button" class="btn btn-danger-outline"
                                                (click)="onClear()">clear</button>

                                            <button class="btn btn-primary btn-with-icon btn-xs">
                                                <span>Search</span>
                                                <span class="btn-icon">
                                                    <mat-icon>search</mat-icon>
                                                </span>
                                            </button>

                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </form>

                </div>

                <div class="layout-card-containr">
                    <div>
                        <mat-table #table class="table1" matSort [dataSource]="dsStockAdjList"
                            [@animateStagger]="{value:'50'}" style="overflow:auto;width: 100%;">

                            <ng-container matColumnDef="batchNo">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm class="w-150">
                                    Batch No</mat-header-cell>
                                <mat-cell *matCellDef="let contact" fxShow.gt-sm class="w-150">
                                    {{contact.batchNo}}
                                </mat-cell>
                            </ng-container>

                            <ng-container matColumnDef="batchEdit">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm class="w-150">
                                </mat-header-cell>
                                <mat-cell *matCellDef="let contact" class="w-150">
                                    <ng-container *ngIf="!contact.Batcheditable; else showInput">
                                        <button mat-icon-button (click)="BatchenableEditing(contact)">
                                            <mat-icon>edit</mat-icon></button>
                                    </ng-container>
                                    <ng-template #showInput>

                                        <mat-form-field appearance="fill">
                                            <input matInput [(ngModel)]="contact.batchEdit" [id]="'batchEdit' + index"
                                                (input)="OneditBatch(contact)" />
                                        </mat-form-field>
                                        <button (click)="OnSaveBatch()" matTooltip="Save">
                                            <mat-icon title="Save Record"
                                                class="active-icon green-600 s-16">check</mat-icon>
                                        </button>
                                    </ng-template>

                                </mat-cell>
                            </ng-container>


                            <!-- <ng-container matColumnDef="CGSTPer">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm class="w-100">CGST
                                    (%)</mat-header-cell>
                                <mat-cell *matCellDef="let contact; let index = index" fxShow.gt-sm class="w-100">
                                    <mat-form-field appearance="fill">
                                        <input matInput [(ngModel)]="contact.CGSTPer" [id]="'CGSTPer' + index"
                                            [disabled]="contact.IsVerifiedUserId > 0"
                                            (input)="getCellCalculation(contact)"
                                            (keydown.arrowdown)="setFocus('CGSTPer' + (index + 1))"
                                            (keydown.arrowup)="setFocus('CGSTPer' + (index - 1))" step="0.1"
                                            type="number" [min]="0" [max]="100" OnlyNumber autocomplete="off"
                                            (keypress)="keyPressCharater($event)" />
                                    </mat-form-field>
                                </mat-cell>
                            </ng-container> -->

                            <ng-container matColumnDef="batchExpDate">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxHide fxShow.gt-sm class="w-100">
                                    Exp.Date
                                </mat-header-cell>
                                <mat-cell *matCellDef="let contact" fxShow.gt-sm class="w-100">
                                    {{contact.batchExpDate | date:'dd/MM/YYYY'}}
                                </mat-cell>
                            </ng-container>

                         
                            <ng-container matColumnDef="expDateEdit">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm class="w-200">
                                </mat-header-cell>
                                <mat-cell *matCellDef="let contact" class="w-200">
                                    <ng-container *ngIf="!contact.Expeditable; else showInput">
                                        <button mat-icon-button (click)="ExpDateenableEditing(contact)">
                                            <mat-icon>edit</mat-icon></button>
                                    </ng-container>
                                    <ng-template #showInput>
 <!-- (input)="OneditDate(contact)" -->
                                        <form [formGroup]="StoreFrom">
                                            <mat-form-field appearance="outline" fxFlex="40%">
                                                <mat-label>ExpDate</mat-label>
                                                <input matInput #inputField (keyup)="calculateLastDay(contact)" formControlName="expDateEdit" [formGroup]="StoreFrom"
                                                    [(ngModel)]="contact.expDateEdit" autocomplete="off" (blur)="ExpDatedisableEditing(contact)"
                                                    placeholder="mmyyyy" [id]="'expDateEdit' + index" >
                                            </mat-form-field>
                                        </form>
                                        <button (click)="OnSaveBatchAdj()" matTooltip="Save">
                                            <mat-icon title="Save Record"
                                                class="active-icon green-600 s-16">check</mat-icon>
                                        </button>
                                    </ng-template>

                                </mat-cell>
                            </ng-container>


                            <ng-container matColumnDef="landedRate">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm>
                                    LandedRate</mat-header-cell>
                                <mat-cell *matCellDef="let contact" fxShow.gt-sm>
                                    {{contact.landedRate}}
                                </mat-cell>
                            </ng-container>

                            <ng-container matColumnDef="unitMRP">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm fxFlex="20%">
                                    UnitMRP
                                </mat-header-cell>
                                <mat-cell *matCellDef="let contact" fxFlex="20%">
                                    {{contact.unitMRP}}
                                    <ng-container>
                                        <button mat-icon-button (click)="EditMRP(contact)">
                                            <mat-icon>edit</mat-icon></button>
                                    </ng-container>
                                </mat-cell>
                            </ng-container>

                            <ng-container matColumnDef="purUnitRateWF">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm>
                                    Purchase Rat</mat-header-cell>
                                <mat-cell *matCellDef="let contact" fxShow.gt-sm>
                                    {{contact.purUnitRateWF}}
                                </mat-cell>
                            </ng-container>

                            <ng-container matColumnDef="balanceQty">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm>
                                    Bal Qty</mat-header-cell>
                                <mat-cell *matCellDef="let contact" fxShow.gt-sm>
                                    {{contact.balanceQty }}
                                </mat-cell>
                            </ng-container>

                            <!-- <ng-container matColumnDef="Addition">
                                <mat-header-cell *matHeaderCellDef style="color: white;">
                                    Addition</mat-header-cell>
                                <mat-cell *matCellDef="let contact">
                                    <ng-container *ngIf="!contact.Addeditable; else showInput">
                                        <button mat-icon-button (click)="enableEditing(contact)">
                                            <mat-icon>edit</mat-icon></button>
                                    </ng-container>
                                    <ng-template #showInput>
                                        <mat-form-field appearance="legacy" class="w-60">
                                            <input matInput [(ngModel)]="contact.AddQty" type="text" OnlyNumber
                                                (blur)="disableEditing(contact)" autocomplete="off"
                                                (keyup)="AddQty(contact,contact.AddQty)">
                                        </mat-form-field>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                        <buttom mati-icon-button (click)="onsaveStockAdj()" matTooltip="Save">
                                            <mat-icon title="Save Reocrd"
                                                class="active-icon green-600 s-16">check</mat-icon>
                                        </buttom>
                                    </ng-template>
                                </mat-cell>
                            </ng-container>

                            <ng-container matColumnDef="Deduction">
                                <mat-header-cell *matHeaderCellDef style="color: white;">
                                    Deduction</mat-header-cell>
                                <mat-cell *matCellDef="let contact">
                                    <ng-container *ngIf="!contact.Dedueditable; else showInput">
                                        <button mat-icon-button (click)="deduenableEditing(contact)">
                                            <mat-icon>edit</mat-icon></button>
                                    </ng-container>
                                    <ng-template #showInput>
                                        <mat-form-field appearance="legacy" class="w-60">
                                            <input matInput [(ngModel)]="contact.DeduQty" type="text" OnlyNumber
                                                (keyup)="DeduQty(contact,contact.DeduQty)" autocomplete="off"
                                                (blur)="dedudisableEditing(contact)">
                                        </mat-form-field>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                        <buttom mati-icon-button (click)="onsaveStockAdj()" matTooltip="Save">
                                            <mat-icon title="Save Reocrd"
                                                class="active-icon green-600 s-16">check</mat-icon>
                                        </buttom>
                                    </ng-template>
                                </mat-cell>
                            </ng-container> -->

                            <ng-container matColumnDef="conversionFactor">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm>
                                    Packing</mat-header-cell>
                                <mat-cell *matCellDef="let contact" fxShow.gt-sm>
                                    {{contact.conversionFactor}}
                                </mat-cell>
                            </ng-container>

                            <ng-container matColumnDef="vatPercentage">
                                <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm>
                                    GST %</mat-header-cell>
                                <mat-cell *matCellDef="let contact" fxShow.gt-sm>
                                    {{contact.vatPercentage}}%
                                    <ng-container>
                                        <button mat-icon-button (click)="EditGST(contact)">
                                            <mat-icon>edit</mat-icon></button>
                                    </ng-container>
                                </mat-cell>
                            </ng-container>

                            <ng-container matColumnDef="loading">
                                <mat-header-cell *matFooterCellDef colspan="6" style="display: none;">
                                </mat-header-cell>
                            </ng-container>

                            <ng-container matColumnDef="noData">
                                <mat-footer-cell *matFooterCellDef colspan="6">
                                    no data found...
                                </mat-footer-cell>
                            </ng-container>

                            <mat-header-row class="accent" *matHeaderRowDef="displayedColumns; sticky: true">
                            </mat-header-row>
                            <mat-row *matRowDef="let contact; columns: displayedColumns;" class="contact"
                                [@animate]="{value:'*',params:{y:'100%'}}"></mat-row>
                            <mat-footer-row *matFooterRowDef="['loading']"
                                [ngClass]="{'hide': !(sIsLoading == 'loading-data')}">
                            </mat-footer-row>
                            <mat-footer-row *matFooterRowDef="['noData']"
                                [ngClass]="{'hide':!(dsStockAdjList!=null && dsStockAdjList.data.length==0)}">
                            </mat-footer-row>
                        </mat-table>
                        <mat-paginator #paginator [pageSizeOptions]="[10, 15, 25, 100]" [pageSize]="15"
                            showFirstLastButtons>
                        </mat-paginator>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 
<div class="page-layout simple inner-sidebar inner-scroll right-sidebar" style="height: 100%;" fusePerfectScrollbar
    dynamicTableHeight>
    <mat-toolbar class="top-header accent">
        <div fxLayout="row" fxLayoutAlign="start center" class="top-header-info">
            <button mat-icon-button class="sidebar-toggle ">
                <mat-icon>menu</mat-icon>
            </button>
            <mat-icon class="logo-icon" [@animate]="{value:'*',params:{delay:'50ms',scale:'0.2'}}">account_box
            </mat-icon>
            <span class="logo-text h1" [@animate]="{value:'*',params:{delay:'100ms',x:'-25px'}}">
                Stock Adjustment
            </span>
        </div>
    </mat-toolbar>
    
            <div fusePerfectScrollbar
                class="page-layout simple left-sidebar inner-sidebar inner-scroll update-grn mat-form-field-auto"
                dynamicTableHeight>
                               
                <div id="contacts" class="page-layout simple left-sidebar inner-sidebar inner-scroll">
                    <airmid-table [gridConfig]="gridConfig" class="content">
                        <ng-container filters>
                            <mat-form-field appearance="outline" fxFlex>
                                <mat-label>Store Name </mat-label>
                                <input matInput placeholder="Search StoreName " autocomplete="off"
                                    [(ngModel)]="gridConfig.filters[0].fieldValue" />
                                <button matSuffix mat-icon-button aria-label="Clear"
                                    (click)="gridConfig.filters[0].fieldValue=''">
                                    <mat-icon>close</mat-icon>
                                </button>
                            </mat-form-field>
                            <mat-form-field appearance="outline" fxFlex>
                                <mat-label>Item Name</mat-label>
                                <input matInput placeholder="Search ItemName" autocomplete="off"
                                    [(ngModel)]="gridConfig.filters[1].fieldValue" />
                                <button matSuffix mat-icon-button aria-label="Clear"
                                    (click)="gridConfig.filters[1].fieldValue=''">
                                    <mat-icon>close</mat-icon>
                                </button>
                            </mat-form-field>
                        </ng-container>
                    </airmid-table>
                </div>
            </div>
 
</div> -->